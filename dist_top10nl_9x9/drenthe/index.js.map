{"version":3,"file":"index.js","sources":["../../src/animate.js","../../src/handlers/trace.js","../../src/handlers/mouse.drag.js","../../src/handlers/mouse.move.js","../../src/handlers/mouse.scroll.js","../../src/handlers/touch.pinch.js","../../src/handlers/touch.drag.js","../../src/mat4.js","../../src/rect.js","../../src/transform.js","../../src/render.js","../../src/tilecontent.js","../../src/ssctree.js","../../src/pubsub.js","../../src/map.js","../../src/index.js"],"sourcesContent":["\"use strict\";\n\n//glCreateProgram\n//glCreateShader\n//glShaderSource\n//glCompileShader\n//glAttachShader\n//glLinkProgram <- after this line opengl got everything it needs, \n//                 you can free shader resources\n//glDetachShader\n//glDeleteShader\n//for{//render loop\n//   glUseProgram\n//   //...drawing operations\n//   glUseProgram(0);\n//}\n//glDeleteProgram\n\n/* from mapbox-gl-js - BSD licensed? */\nconst _now = (function () {\n    if (window.performance &&\n        window.performance.now) {\n        return window.performance.now.bind(window.performance);\n    }\n    else {\n        return Date.now.bind(Date);\n    }\n}());\nexport { _now as now };\n\nconst frame = window.requestAnimationFrame ||\n    window.mozRequestAnimationFrame ||\n    window.webkitRequestAnimationFrame ||\n    window.msRequestAnimationFrame;\n\nconst _frame = function (fn) {\n    return frame(fn);\n};\nexport { _frame as frame };\n\nconst cancel = window.cancelAnimationFrame ||\n    window.mozCancelAnimationFrame ||\n    window.webkitCancelAnimationFrame ||\n    window.msCancelAnimationFrame;\n\nexport function cancelFrame(id) {\n    cancel(id);\n}\n\nexport function timed(fn, dur, ctx) {\n    if (!dur) {\n        fn.call(ctx, 1);\n        return null;\n    }\n\n    let abort = false;\n    const start = _now();\n\n    function tick(now) {\n        if (abort) {\n            return;\n        }\n        now = _now();\n\n        if (now >= (start + dur)) {\n            fn.call(ctx, 1);\n        } else {\n            let k = (now - start) / dur\n            fn.call(ctx, k);\n            _frame(tick);\n        }\n    }\n\n    _frame(tick);\n\n    return function () { abort = true; };\n}\n\n","/**\n* Records the trace of the mouse\n*/\n\nimport { now as _now } from '../animate';\n\nclass Trace\n{\n    constructor(val)\n    {\n        this._trace = []\n        this.push(val);\n    }\n\n    shift(cutoff)  // value in msec\n    {\n        // remove old positions older than `cutoff` value (in milli seconds)\n        const now = _now();\n        while ((this._trace.length > 0) && ((now - this._trace[0][0]) > cutoff))\n        {\n            // remove at beginning of array\n            this._trace.shift();\n        }\n    }\n\n    push(val)\n    {\n        const now = _now();\n        this._trace.push([now, val]);\n    }\n\n    first()\n    {\n        return this._trace[0]\n    }\n\n    last()\n    {\n        return this._trace[this._trace.length - 1]\n    }\n\n    lastbutone()\n    {\n        return this._trace[this._trace.length - 2]\n    }\n\n    length()\n    {\n        return this._trace.length\n    }\n}\n\nexport default Trace\n","\nimport Trace from './trace';\n\nexport function dragHandler(map) {\n\n    var canvas = map.getCanvasContainer();\n    canvas.addEventListener(\"mousedown\", doMouseDown, { passive: false });\n    // canvas.addEventListener(\"touchstart\", doMouseDown, { passive: false });\n    canvas.oncontextmenu = function (evt) {\n        // prevent context menu from popping up\n        evt.preventDefault();\n    };\n\n    var _trace = null;\n\n    function doMouseDown(evt) {\n        // prevent cursor to turn into text selection on chrome\n        evt.preventDefault();\n        canvas.removeEventListener(\"mousedown\", doMouseDown, { passive: false });\n        canvas.addEventListener(\"mousemove\", doMouseDrag, { passive: false });\n        canvas.addEventListener(\"mouseup\", doMouseUp, { passive: false });\n\n        // canvas.removeEventListener(\"touchstart\", doMouseDown, { capture: true, passive: false });\n        // canvas.addEventListener(\"touchmove\", doMouseDrag, { capture: true, passive: false });\n        // canvas.addEventListener(\"touchend\", doMouseUp, { capture: true, passive: false });\n\n        var r = canvas.getBoundingClientRect();\n        let e = evt.touches ? evt.touches[0] : evt;\n\n        const x = e.clientX - r.left - canvas.clientLeft;\n        const y = e.clientY - r.top - canvas.clientTop;\n\n        //        console.log('doMouseDown');\n        //        console.log([x,y]);\n\n        _trace = new Trace([x, y]);\n        map.panBy(0, 0); // to cancel on going animations\n    }\n\n    function doMouseDrag(evt) {\n        evt.preventDefault();\n        const r = canvas.getBoundingClientRect();\n        // for mouse use raw evt, for touches, use first touch location\n        let e = evt.touches ? evt.touches[0] : evt;\n\n        const x = e.clientX - r.left - canvas.clientLeft;\n        const y = e.clientY - r.top - canvas.clientTop;\n\n        // how much did the map move since last time?\n        let prev = _trace.last()[1]\n        let dx = x - prev[0];\n        let dy = y - prev[1];\n        _trace.shift(200)\n        _trace.push([x, y]);\n\n        //        console.log([x,y]);\n\n        // pan the map\n        map.panBy(dx, dy);\n    }\n\n    function doMouseUp(evt) {\n\n        canvas.removeEventListener(\"mousemove\", doMouseDrag, { passive: false });\n        canvas.removeEventListener(\"mouseup\", doMouseUp, { passive: false });\n        canvas.addEventListener(\"mousedown\", doMouseDown, { passive: false });\n\n        // canvas.removeEventListener(\"touchmove\", doMouseDrag, { capture: true, passive: false });\n        // canvas.removeEventListener(\"touchend\", doMouseUp, { capture: true, passive: false });\n        // canvas.addEventListener(\"touchstart\", doMouseDown, { capture: true, passive: false });\n\n        const r = canvas.getBoundingClientRect();\n        // for mouse use raw evt, for touches, use first touch location\n        let e = evt.changedTouches ? evt.changedTouches[0] : evt;\n\n        const x = e.clientX - r.left - canvas.clientLeft;\n        const y = e.clientY - r.top - canvas.clientTop;\n\n        _trace.shift(200)\n        _trace.push([x, y]);\n\n        //        console.log('doMouseUp');\n        //        console.log([x,y])\n\n        // FIXME\n        // if a user can influence the duration\n        // then if the user did set duration = 0 we should not do any panning!\n        //\n        // furthermore, maybe more natural for moving is that the map slows down\n        //\n        // also: \n        // the map should move initially with the same speed (as the user was moving) and \n        // then slowly come to a halt\n        const last = _trace.last()\n        const first = _trace.first()\n        // in seconds\n        let time = (last[0] - first[0]) / 1000\n\n        // so then we can see given the desired duration\n        // how far could the map travel with the same speed\n        // then if we ease out, we travel a bit less far\n        // so that it looks ok\n\n        let start = first[1]\n        let dx = (x - start[0]);\n        let dy = (y - start[1]);\n\n        // take percent of speed computed\n        const percent = 1.0 // 0.7\n        let vx = dx / time * percent\n        let vy = dy / time * percent\n\n        // const max_distance = 400 // 0.5 * screen size\n        // var duration = parseFloat(document.getElementById('panduration').value);\n        // // with combined speed  of departure and arrivale\n        // // * departure (= speed of user action px/s) and\n        // // * arrival (= 0 px /s)\n        // // we can calcualte what will be the distance travelled\n        // // we cap the distance moved at maximum of certain number of pixels\n        // // (to prevent map moving too far: heuristic, half the window size)\n        // var tx = Math.max(Math.min((vx * 0.5) * (duration / 1000), max_distance), -max_distance)\n        // var ty = Math.max(Math.min((vy * 0.5) * (duration / 1000), max_distance), -max_distance)\n        // map.panAnimated(tx, ty);\n\n        // FIXME: settings\n        let duration = parseFloat(map._interaction_settings.pan_duration);\n        // var duration = 1000; // parseFloat(document.getElementById('panduration').value);\n        let tx = (vx * 0.5) * (duration / 1000);\n        let ty = (vy * 0.5) * (duration / 1000);\n        _trace = null;\n        map.panAnimated(tx, ty);\n        // console.log('mouseup')\n    }\n\n}\n","\"use strict\";\n\n/**\n* Handler while the mouse is being moved, without any buttons pressed\n* Does show the real world coordinates where the mouse is hovering\n*/\n\n// FIXME: when the mouse stays at the same location, \n// and the view of the map is animated\n// the values of the scale and coordinates do change, \n// but this is *not* reflected in the UI\nexport function moveHandler (map) {\n\n    const _map = map;\n    var _canvas = map.getCanvasContainer();\n\n    _canvas.addEventListener(\"mousedown\", doMouseDown, false);\n    _canvas.addEventListener(\"mousemove\", doMouseMove, false);\n\n    function doMouseDown(evt)\n    {\n        // prevent cursor to turn into text selection on chrome\n        evt.preventDefault();\n        _canvas.addEventListener(\"mouseup\", doMouseUp, false);\n        _canvas.removeEventListener(\"mousemove\", doMouseMove, false);\n    }\n\n    function doMouseMove(evt)\n    {\n        //console.log(\"do hover\");\n        var r = _canvas.getBoundingClientRect();\n        var x = evt.clientX - r.left - _canvas.clientLeft;\n        var y = evt.clientY - r.top - _canvas.clientTop;\n        const transformed = _map.getTransform().backward([x, r.height-y, 0]);\n        let scale = _map.getTransform().getScaleDenominator();\n        displayCoordinates(transformed, scale);\n    }\n\n    // eslint-disable-next-line no-unused-vars\n    function doMouseUp(evt)\n    {\n        _canvas.removeEventListener(\"mouseup\", doMouseUp, false);\n        _canvas.addEventListener(\"mousemove\", doMouseMove, false);\n    }\n\n    function displayCoordinates(coords, scale)\n    {\n        console.log(coords[0].toFixed(1) + \", \" + coords[1].toFixed(1) + \" 1:\" + scale.toFixed(0))\n        // -- modify the DOM\n        /*\n        var list = document.getElementById(\"mouse-move-output\");\n        var li = document.createElement('li');\n        var val = document.createTextNode(coords[0].toFixed(1) + \", \" + coords[1].toFixed(1) + \" 1:\" + scale.toFixed(0));\n        li.appendChild(val);\n        if (list.childNodes[0] !== undefined)\n        {\n            list.replaceChild(li, list.childNodes[0]);\n        }\n        else\n        {\n            list.appendChild(li);\n        }\n        */\n        // end modify\n    }\n}\n","\"use strict\";\n\n/**\n* Handler for a scroll of the MouseWheel\n*\n* Starts an animated zoom (in or out) operation\n*/\n\nimport { now as _now } from '../animate';\nimport Trace from './trace';\n\nexport function scrollHandler (map) {\n\n    const _map = map;\n    const _canvas = map.getCanvasContainer();\n\n    _canvas.addEventListener(\"wheel\", doMouseWheel, { passive: false });\n    _canvas.addEventListener(\"mousewheel\", doMouseWheel, { passive: false });\n\n    var _trace = null;\n    var _prev = null;\n\n    function doMouseWheel(evt)\n    {\n        // prevent from also scrolling the page -- not allowed when passive: true\n        evt.preventDefault();\n        // return if previous evt is shorter than n msec ago\n        const now = _now();\n        if ((now - _prev) < 20)\n        {\n            return \n        }\n        // find the wheel value (this is implemented differently per browser)\n        let value = undefined\n        if (evt.type === 'wheel')\n        {\n            value = evt.deltaY;\n            // Firefox doubles the values on retina screens...\n            // if (firefox && e.deltaMode === window.WheelEvent.DOM_DELTA_PIXEL) value /= browser.devicePixelRatio;\n            // if (e.deltaMode === window.WheelEvent.DOM_DELTA_LINE) value *= 40;\n        }\n        else if (evt.type === 'mousewheel')\n        {\n            value = -evt.wheelDeltaY;\n            // if (safari) value = value / 3;\n        }\n        // sometimes, we see a value of 0 \n        // i.e. undetermined y-direction, so skip evt\n        if (value === 0)\n        {\n            return\n        }\n        _prev = now\n\n        // standard value for zoom scroll_factor\n        var scroll_factor = 0.1;\n        const direction = Math.max(-1, Math.min(1, -value));\n        if (_trace === null)\n        {\n            _trace = new Trace(direction);\n        }\n        else\n        {\n            let prev = _trace.last()\n            const delta = now - prev[0]\n            _trace.push(direction);\n\n            // FIXME: SETTINGS: \n            //var radios = document.getElementsByName('speed');\n            //let speed = 1\n            // FIXME: SETTINGS: \n            \n            //for (var i = 0, length = radios.length; i < length; i++) {\n            //    if (radios[i].checked) {\n            //        // do whatever you want with the checked radio\n            //        speed = parseFloat(radios[i].value)\n            //        // only one radio can be logically checked, don't check the rest\n            //        break;\n            //    }\n            //}\n            \n            //speed = getspeed()\n\n            // make larger zoom scroll_factors if mousewheel went faster\n            // FIXME: allow user to set multiplication scroll_factor, e.g.\n            // (1, 2, 4) : (normal, fast, superfast) ?\n            switch (true)\n            {\n                case delta > 750:\n                    scroll_factor = 0.0625\n                    break;\n                case delta > 500:\n                    scroll_factor = 0.125\n                    break;\n                case delta > 50:\n                    scroll_factor = 0.25\n                    break;\n                default:\n                    scroll_factor = 0.5\n                    break;\n            }\n            scroll_factor *= getspeed()\n            _trace.shift(2000);\n//            console.log(delta + \" \" + prev[1] + \" \" + scroll_factor);\n        }\n\n        //if the canvas has size 800 x 800, \n        //evt.clientX: x-coordinate in pixel, starting from the left of the canvas (800 x 800)\n        //evt.clientY: y-coordinate in pixel, starting from the top of the canvas (800 x 800)        \n        //r has size 800 x 760 because of the bar (with height 39.92) at the top\n        //r.left = 0 and r.top = 39.92\n        const r = _canvas.getBoundingClientRect();\n        const x = evt.clientX - r.left - _canvas.clientLeft;  //_canvas.clientLeft is often 0\n        const y = evt.clientY - r.top - _canvas.clientTop;  //_canvas.clientTop is often 0\n\n        switch(direction) \n        {\n            case 1:\n                _map.zoomInAnimated(x, y, scroll_factor);\n                break;\n            case -1:\n                _map.zoomOutAnimated(x, y, scroll_factor);\n                break;\n        }\n//        console.log(_trace._trace);\n        // console.log(_trace.length())\n    }\n}\n\n\nfunction getspeed() {\n    var radios = document.getElementsByName('speed');\n    let factor = 1\n    for (var i = 0, length = radios.length; i < length; i++) {\n        if (radios[i].checked) {\n            // do whatever you want with the checked radio\n            factor = parseFloat(radios[i].value)\n            // only one radio can be logically checked, don't check the rest\n            break;\n        }\n    }\n\n    return factor\n}\n\n\n\nexport function zoomButtonHandler(map) {\n    const canvas = map.getCanvasContainer();\n\n    document.getElementById(\"zoomInButton\").addEventListener('click',\n        function () {\n            map.zoomInAnimated(canvas.width / 2, canvas.height / 2, getspeed())\n        }\n    )\n\n    document.getElementById(\"zoomOutButton\").addEventListener('click',\n        function () {\n            map.zoomOutAnimated(canvas.width / 2, canvas.height / 2, getspeed())\n        }\n    )\n}","\"use strict\";\n\nimport { now as _now } from '../animate';\nimport Trace from './trace';\n\n/**\n* Handler for touch events\n* zooms the map if two fingers are used and the distance between them changes.\n* \n*/\n\nexport function touchPinchHandler (map) {\n    var canvas = map.getCanvasContainer();\n\n    canvas.addEventListener(\"touchstart\", doPinchStart, false);\n    canvas.oncontextmenu = function (evt) {\n        // prevent context menu from popping up\n        evt.preventDefault();\n    };\n\n    function dist(points) {\n        const [dx, dy] = vec(points);\n        return Math.sqrt(dx * dx, dy * dy);\n    }\n\n    function center(points) {\n        const [dx, dy] = vec(points);\n        let p0 = points[0];\n        return [p0[0] + dx / 2,\n                p0[1] + dy / 2];\n    }\n\n    function vec(points) {\n        let dx = points[1][0] - points[0][0];\n        let dy = points[1][1] - points[0][1];\n        return [dx, dy];\n    }\n\n    function getTouchPoints(event) {\n        const r = canvas.getBoundingClientRect();\n        const touches = event.touches;\n        var points = [];\n        // note: length hardcoded as 2\n        for (let j = 0; j < 2; j++) {\n            const x = touches[j].clientX - r.left - canvas.clientLeft;\n            const y = touches[j].clientY - r.top - canvas.clientTop;\n            points.push([x, y]);\n        }\n        return points;\n    }\n\n    var _prevDist = null;\n    var _startTime = null;\n    var _trace = null;\n    // var _startCenter = null;\n\n    function doPinchStart(event) {\n        if (!event.touches || event.touches.length !== 2) { return; }\n        event.preventDefault();\n\n        canvas.removeEventListener(\"touchstart\", doPinchStart, false);\n        canvas.addEventListener(\"touchmove\", doPinchMove, { capture: true, passive: false });\n        canvas.addEventListener(\"touchend\", doPinchEnd, false);\n        \n        // let points = getTouchPoints(event);\n        // console.log(points);\n        // _startCenter = center(points);\n        _prevDist = null;\n        _startTime = _now();\n        console.log('start touch with 2 fingers ' + _startTime);\n        map.abortAndRender(); // to cancel on going animations\n        let points = getTouchPoints(event);\n        _trace = new Trace(points);\n    }\n\n    function doPinchMove(event) {\n        if (!event.touches || event.touches.length !== 2 || (_now() - _startTime) < 30) { return; }\n        console.log('time of touch ' + (_now() - _startTime));\n        // we discard the first few movement events at the beginning (30 ms since start)\n        // these seem to be 'unstable', are rapidly fired after placing the fingers on \n        // the screen and they lead to wildly varying positions\n        event.preventDefault();\n        let points = getTouchPoints(event);\n        _trace.shift(200);\n        _trace.push(points);\n        // console.log(points);\n        let curDist = dist(points);\n        if (_prevDist !== null) {\n            let scaleDelta = curDist / _prevDist;\n            // console.log(scaleDelta);\n            let [x, y] = center(points);\n            map.zoom(x, y, Math.max(Math.min(scaleDelta, 1.1), 0.9));\n        }\n        _prevDist = curDist;\n    }\n\n    function doPinchEnd(event) {\n        if (event.touches.length !== 0) { return; }\n        event.preventDefault();\n        console.log('end');\n        canvas.removeEventListener(\"touchmove\", doPinchMove, { capture: true, passive: false });\n        canvas.removeEventListener(\"touchend\", doPinchEnd, false);\n        canvas.addEventListener(\"touchstart\", doPinchStart, false);\n        _prevDist = null;\n        _startTime = null;      \n        console.log('trace for pinch end ' + _trace.length());\n        if (_trace.length() > 1)\n        {\n            // FIXME:\n            // should the intent of the user be derived from \n            // comparing the last two touch points only?\n            // or, should we compare begin and end of the gesture\n            // or, should we detect some pattern in the gesture points?\n            // or, ... \n            let last = _trace.last();\n            let lastbutone = _trace.lastbutone();\n            let curDist = dist(last[1]);\n            let prevDist = dist(lastbutone[1]);\n            // let scaleDelta = curDist / prevDist;\n            let [x, y] = center(last[1]);\n            let step = 0.5;\n            if (curDist < prevDist)\n            {\n                // distance between fingers has become smaller\n                // -> zoom out\n                map.zoomOutAnimated(x, y, step)\n            } else {\n                // distance between fingers has become larger\n                // -> zoom in\n                map.zoomInAnimated(x, y, step)\n            }\n\n            // FIXME: \n            // should we take the zoom step preference of the\n            // user into account here? e.g. large zoom step -> \n            // allows larger change of the clamped scaledelta?\n            // map.zoomAnimated(x, y, Math.max(Math.min(scaleDelta, 1.2), 0.8));\n        }\n        _trace = null;       \n    }\n}\n\n\n","import Trace from './trace';\n\nexport function touchDragHandler(map) {\n    var canvas = map.getCanvasContainer();\n    canvas.addEventListener(\"touchstart\", doTouchDragStart, false);\n    // canvas.addEventListener(\"touchstart\", doMouseDown, { passive: false });\n    canvas.oncontextmenu = function (evt) {\n        // prevent context menu from popping up\n        evt.preventDefault();\n    };\n\n    function getTouchPoint(event) {\n        const r = canvas.getBoundingClientRect();\n        const touches = event.touches;       \n        const x = touches[0].clientX - r.left - canvas.clientLeft;\n        const y = touches[0].clientY - r.top - canvas.clientTop;\n            \n        return [x, y];\n    }\n\n    var _trace = null;\n    var _state = null;\n\n    function doTouchDragStart(evt) {\n        if (evt.touches.length > 1) {\n            return;\n        }\n        // prevent cursor to turn into text selection on chrome\n        evt.preventDefault();\n        // map.abortAndRender(); // to cancel on going animations\n        canvas.removeEventListener(\"touchstart\", doTouchDragStart, false);\n        canvas.addEventListener(\"touchmove\", doTouchDragMove, { capture: true, passive: false });\n        canvas.addEventListener(\"touchend\", doTouchDragEnd, false);\n        // canvas.removeEventListener(\"touchstart\", doMouseDown, { capture: true, passive: false });\n        // canvas.addEventListener(\"touchmove\", doMouseDrag, { capture: true, passive: false });\n        // canvas.addEventListener(\"touchend\", doMouseUp, { capture: true, passive: false });\n        \n        //        console.log('doMouseDown');\n        //        console.log([x,y]);\n        let point = getTouchPoint(evt);\n        _trace = new Trace(point);\n        _state = 'pending';\n    }\n    function doTouchDragMove(evt) {\n        \n        // when we detect more than 1 finger on the screen\n        // we obviously do not want to pan, so we set the state to\n        // pending (i.e. currently we do not handle events for panning)\n        if (evt.touches.length > 1) \n        {\n            _state = 'pending';\n            return;\n        }\n        evt.preventDefault();\n        let point = getTouchPoint(evt);\n        \n        // how much did the map move since last time?\n        let prev = _trace.last()[1];\n        let dx = point[0] - prev[0];\n        let dy = point[1] - prev[1];\n        _trace.shift(200);\n        _trace.push(point);\n\n        \n        switch(_state)\n        {\n            case 'pending':\n                // enable the handler when:\n                // - we have moved our finger more than 3 pixels, or\n                // - we have 1 finger for more than 80ms on the screen\n                if (Math.sqrt(dx * dx, dy * dy) >= 3 || (_trace.last()[0] - _trace.first()[0])> 60) {\n                    _state = 'active';\n                }\n                break;\n            case 'active':\n                map.panBy(dx, dy);\n                break;\n        }\n    }\n    function doTouchDragEnd(evt) {\n        if (evt.touches.length !== 0) { return; }\n        canvas.removeEventListener(\"touchmove\", doTouchDragMove, { capture: true, passive: false });\n        canvas.removeEventListener(\"touchend\", doTouchDragEnd, false);\n        canvas.addEventListener(\"touchstart\", doTouchDragStart, false);\n        // canvas.removeEventListener(\"touchmove\", doMouseDrag, { capture: true, passive: false });\n        // canvas.removeEventListener(\"touchend\", doMouseUp, { capture: true, passive: false });\n        // canvas.addEventListener(\"touchstart\", doMouseDown, { capture: true, passive: false });\n        // let point = getTouchPoint(evt);\n        // _trace.shift(200);\n        // _trace.push(point);\n        //        console.log('doMouseUp');\n        //        console.log([x,y])\n        // FIXME\n        // if a user can influence the duration\n        // then if the user did set duration = 0 we should not do any panning!\n        //\n        // furthermore, maybe more natural for moving is that the map slows down\n        //\n        // also: \n        // the map should move initially with the same speed (as the user was moving) and \n        // then slowly come to a halt\n        _trace.shift(200);\n        if (_trace.length() <= 2)\n        {\n            _state = 'pending';\n        }\n        switch(_state)\n        {\n            case 'pending':\n            {\n                console.log('touch drag end - SKIP');\n                break;\n            }\n            case 'active':\n            {               \n                const last = _trace.last();   \n                const first = _trace.first();\n                // in seconds\n                let time = (last[0] - first[0]) / 1000;\n                // so then we can see given the desired duration\n                // how far could the map travel with the same speed\n                // then if we ease out, we travel a bit less far\n                // so that it looks ok\n                let start = first[1];\n                let dx = (last[1][0] - start[0]);\n                let dy = (last[1][1] - start[1]);\n                // take percent of speed computed\n                const percent = 1.0; // 0.7\n                let vx = dx / time * percent;\n                let vy = dy / time * percent;\n                // const max_distance = 400 // 0.5 * screen size\n                let duration = parseFloat(map._interaction_settings.pan_duration);\n                // var duration = parseFloat(document.getElementById('panduration').value);\n                // with combined speed  of departure and arrivale\n                // * departure (= speed of user action px/s) and\n                // * arrival (= 0 px /s)\n                // we can calcualte what will be the distance travelled\n                // we cap the distance moved at maximum of certain number of pixels\n                // (to prevent map moving too far: heuristic, half the window size)\n                // var tx = Math.max(Math.min((vx * 0.5) * (duration / 1000), max_distance), -max_distance)\n                // var ty = Math.max(Math.min((vy * 0.5) * (duration / 1000), max_distance), -max_distance)\n                let tx = (vx * 0.5) * (duration / 1000);\n                let ty = (vy * 0.5) * (duration / 1000);\n\n                console.log('touch drag end - ANIMATE');\n                console.log([tx, ty]);\n                map.panAnimated(tx, ty);\n\n                break;\n            }\n        }\n        _state = 'pending';\n        _trace = null;\n        console.log('touchend');\n    }\n}\n","\"use strict\";\n\n/**\n * @name mat4\n * @class 4x4 Matrix\n */\n\n//exports.___ = function \n\n\n// vector funcs !!!\nexport function vec3transform (out, a, m) {\n    var x = a[0], y = a[1], z = a[2],\n        w = m[3] * x + m[7] * y + m[11] * z + m[15];\n    w = w || 1.0; //if w == 0 or w == null, the result is 1.0; otherwise, the result is w\n//    console.log(m[0] + \" \" + x + \" \" + m[4]);\n    out[0] = (m[0] * x + m[4] * y + m[8] * z + m[12]) / w;\n    out[1] = (m[1] * x + m[5] * y + m[9] * z + m[13]) / w;\n    out[2] = (m[2] * x + m[6] * y + m[10] * z + m[14]) / w;\n//    console.log(out[0]);\n    return out;\n}\n\nexport function createvec3() {\n    var out = new Float32Array(3);\n    out[0] = 0;\n    out[1] = 0;\n    out[2] = 0;\n    return out;\n}\n\n\n/**\n * Creates a new identity mat4\n *\n * @returns {mat4} a new 4x4 matrix\n */\nexport function create() {\n    var out = new Float32Array(16);\n    out[0] = 1;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = 1;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[10] = 1;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n    out[15] = 1;\n    return out;\n}\n\n\n/**\n * Creates a new mat4 initialized with values from an existing matrix\n *\n * @param {mat4} a matrix to clone\n * @returns {mat4} a new 4x4 matrix\n */\nexport function clone(a) {\n    var out = new Float32Array(16);\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[8] = a[8];\n    out[9] = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n    return out;\n}\n\n/**\n * Copy the values from one mat4 to another\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the source matrix\n * @returns {mat4} out\n */\n\n\nexport function copy (out, a) {\n    out[0] = a[0];\n    out[1] = a[1];\n    out[2] = a[2];\n    out[3] = a[3];\n    out[4] = a[4];\n    out[5] = a[5];\n    out[6] = a[6];\n    out[7] = a[7];\n    out[8] = a[8];\n    out[9] = a[9];\n    out[10] = a[10];\n    out[11] = a[11];\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n    return out;\n}\n\n/**\n * Create a new mat4 with the given values\n *\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} A new mat4\n */\nexport function fromValues (m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n    var out = new Float32Array(16);\n    out[0] = m00;\n    out[1] = m01;\n    out[2] = m02;\n    out[3] = m03;\n    out[4] = m10;\n    out[5] = m11;\n    out[6] = m12;\n    out[7] = m13;\n    out[8] = m20;\n    out[9] = m21;\n    out[10] = m22;\n    out[11] = m23;\n    out[12] = m30;\n    out[13] = m31;\n    out[14] = m32;\n    out[15] = m33;\n    return out;\n}\n\n/**\n * Set the components of a mat4 to the given values\n *\n * @param {mat4} out the receiving matrix\n * @param {Number} m00 Component in column 0, row 0 position (index 0)\n * @param {Number} m01 Component in column 0, row 1 position (index 1)\n * @param {Number} m02 Component in column 0, row 2 position (index 2)\n * @param {Number} m03 Component in column 0, row 3 position (index 3)\n * @param {Number} m10 Component in column 1, row 0 position (index 4)\n * @param {Number} m11 Component in column 1, row 1 position (index 5)\n * @param {Number} m12 Component in column 1, row 2 position (index 6)\n * @param {Number} m13 Component in column 1, row 3 position (index 7)\n * @param {Number} m20 Component in column 2, row 0 position (index 8)\n * @param {Number} m21 Component in column 2, row 1 position (index 9)\n * @param {Number} m22 Component in column 2, row 2 position (index 10)\n * @param {Number} m23 Component in column 2, row 3 position (index 11)\n * @param {Number} m30 Component in column 3, row 0 position (index 12)\n * @param {Number} m31 Component in column 3, row 1 position (index 13)\n * @param {Number} m32 Component in column 3, row 2 position (index 14)\n * @param {Number} m33 Component in column 3, row 3 position (index 15)\n * @returns {mat4} out\n */\n\nexport function set(out, m00, m01, m02, m03, m10, m11, m12, m13, m20, m21, m22, m23, m30, m31, m32, m33) {\n    out[0] = m00;\n    out[1] = m01;\n    out[2] = m02;\n    out[3] = m03;\n    out[4] = m10;\n    out[5] = m11;\n    out[6] = m12;\n    out[7] = m13;\n    out[8] = m20;\n    out[9] = m21;\n    out[10] = m22;\n    out[11] = m23;\n    out[12] = m30;\n    out[13] = m31;\n    out[14] = m32;\n    out[15] = m33;\n    return out;\n}\n\n\n/**\n * Set a mat4 to the identity matrix\n *\n * @param {mat4} out the receiving matrix\n * @returns {mat4} out\n */\nexport function identity(out) {\n    out[0] = 1;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = 1;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[10] = 1;\n    out[11] = 0;\n    out[12] = 0;\n    out[13] = 0;\n    out[14] = 0;\n    out[15] = 1;\n    return out;\n}\n\n/**\n * Transpose the values of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the source matrix\n * @returns {mat4} out\n */\nexport function transpose(out, a) {\n    // If we are transposing ourselves we can skip a few steps but have to cache some values\n    if (out === a) {\n        var a01 = a[1], a02 = a[2], a03 = a[3],\n            a12 = a[6], a13 = a[7],\n            a23 = a[11];\n\n        out[1] = a[4];\n        out[2] = a[8];\n        out[3] = a[12];\n        out[4] = a01;\n        out[6] = a[9];\n        out[7] = a[13];\n        out[8] = a02;\n        out[9] = a12;\n        out[11] = a[14];\n        out[12] = a03;\n        out[13] = a13;\n        out[14] = a23;\n    } else {\n        out[0] = a[0];\n        out[1] = a[4];\n        out[2] = a[8];\n        out[3] = a[12];\n        out[4] = a[1];\n        out[5] = a[5];\n        out[6] = a[9];\n        out[7] = a[13];\n        out[8] = a[2];\n        out[9] = a[6];\n        out[10] = a[10];\n        out[11] = a[14];\n        out[12] = a[3];\n        out[13] = a[7];\n        out[14] = a[11];\n        out[15] = a[15];\n    }\n\n    return out;\n}\n\n/**\n * Inverts a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the source matrix\n * @returns {mat4} out\n */\nexport function invert(out, a) {\n    var a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3],\n        a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7],\n        a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11],\n        a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15],\n\n        b00 = a00 * a11 - a01 * a10,\n        b01 = a00 * a12 - a02 * a10,\n        b02 = a00 * a13 - a03 * a10,\n        b03 = a01 * a12 - a02 * a11,\n        b04 = a01 * a13 - a03 * a11,\n        b05 = a02 * a13 - a03 * a12,\n        b06 = a20 * a31 - a21 * a30,\n        b07 = a20 * a32 - a22 * a30,\n        b08 = a20 * a33 - a23 * a30,\n        b09 = a21 * a32 - a22 * a31,\n        b10 = a21 * a33 - a23 * a31,\n        b11 = a22 * a33 - a23 * a32,\n\n        // Calculate the determinant\n        det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n    if (!det) {\n        return null;\n    }\n    det = 1.0 / det;\n\n    out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n    out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n    out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n    out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det;\n    out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n    out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n    out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n    out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det;\n    out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n    out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n    out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n    out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det;\n    out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det;\n    out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det;\n    out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det;\n    out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det;\n\n    return out;\n}\n\n/**\n * Calculates the adjugate of a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the source matrix\n * @returns {mat4} out\n */\nexport function adjoint(out, a) {\n    var a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3],\n        a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7],\n        a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11],\n        a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];\n\n    out[0]  =  (a11 * (a22 * a33 - a23 * a32) - a21 * (a12 * a33 - a13 * a32) + a31 * (a12 * a23 - a13 * a22));\n    out[1]  = -(a01 * (a22 * a33 - a23 * a32) - a21 * (a02 * a33 - a03 * a32) + a31 * (a02 * a23 - a03 * a22));\n    out[2]  =  (a01 * (a12 * a33 - a13 * a32) - a11 * (a02 * a33 - a03 * a32) + a31 * (a02 * a13 - a03 * a12));\n    out[3]  = -(a01 * (a12 * a23 - a13 * a22) - a11 * (a02 * a23 - a03 * a22) + a21 * (a02 * a13 - a03 * a12));\n    out[4]  = -(a10 * (a22 * a33 - a23 * a32) - a20 * (a12 * a33 - a13 * a32) + a30 * (a12 * a23 - a13 * a22));\n    out[5]  =  (a00 * (a22 * a33 - a23 * a32) - a20 * (a02 * a33 - a03 * a32) + a30 * (a02 * a23 - a03 * a22));\n    out[6]  = -(a00 * (a12 * a33 - a13 * a32) - a10 * (a02 * a33 - a03 * a32) + a30 * (a02 * a13 - a03 * a12));\n    out[7]  =  (a00 * (a12 * a23 - a13 * a22) - a10 * (a02 * a23 - a03 * a22) + a20 * (a02 * a13 - a03 * a12));\n    out[8]  =  (a10 * (a21 * a33 - a23 * a31) - a20 * (a11 * a33 - a13 * a31) + a30 * (a11 * a23 - a13 * a21));\n    out[9]  = -(a00 * (a21 * a33 - a23 * a31) - a20 * (a01 * a33 - a03 * a31) + a30 * (a01 * a23 - a03 * a21));\n    out[10] =  (a00 * (a11 * a33 - a13 * a31) - a10 * (a01 * a33 - a03 * a31) + a30 * (a01 * a13 - a03 * a11));\n    out[11] = -(a00 * (a11 * a23 - a13 * a21) - a10 * (a01 * a23 - a03 * a21) + a20 * (a01 * a13 - a03 * a11));\n    out[12] = -(a10 * (a21 * a32 - a22 * a31) - a20 * (a11 * a32 - a12 * a31) + a30 * (a11 * a22 - a12 * a21));\n    out[13] =  (a00 * (a21 * a32 - a22 * a31) - a20 * (a01 * a32 - a02 * a31) + a30 * (a01 * a22 - a02 * a21));\n    out[14] = -(a00 * (a11 * a32 - a12 * a31) - a10 * (a01 * a32 - a02 * a31) + a30 * (a01 * a12 - a02 * a11));\n    out[15] =  (a00 * (a11 * a22 - a12 * a21) - a10 * (a01 * a22 - a02 * a21) + a20 * (a01 * a12 - a02 * a11));\n    return out;\n}\n\n/**\n * Calculates the determinant of a mat4\n *\n * @param {mat4} a the source matrix\n * @returns {Number} determinant of a\n */\nexport function determinant(a) {\n    var a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3],\n        a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7],\n        a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11],\n        a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15],\n\n        b00 = a00 * a11 - a01 * a10,\n        b01 = a00 * a12 - a02 * a10,\n        b02 = a00 * a13 - a03 * a10,\n        b03 = a01 * a12 - a02 * a11,\n        b04 = a01 * a13 - a03 * a11,\n        b05 = a02 * a13 - a03 * a12,\n        b06 = a20 * a31 - a21 * a30,\n        b07 = a20 * a32 - a22 * a30,\n        b08 = a20 * a33 - a23 * a30,\n        b09 = a21 * a32 - a22 * a31,\n        b10 = a21 * a33 - a23 * a31,\n        b11 = a22 * a33 - a23 * a32;\n\n    // Calculate the determinant\n    return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n}\n\n/**\n * Multiplies two mat4's explicitly\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the first operand\n * @param {mat4} b the second operand\n * @returns {mat4} out\n */\nfunction multiply(out, a, b) {\n    var a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3],\n        a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7],\n        a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11],\n        a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];\n\n    // Cache only the current line of the second matrix\n    var b0  = b[0], b1 = b[1], b2 = b[2], b3 = b[3];\n    out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n    out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n    out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n    out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n    b0 = b[4]; b1 = b[5]; b2 = b[6]; b3 = b[7];\n    out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n    out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n    out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n    out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n    b0 = b[8]; b1 = b[9]; b2 = b[10]; b3 = b[11];\n    out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n    out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n    out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n    out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n\n    b0 = b[12]; b1 = b[13]; b2 = b[14]; b3 = b[15];\n    out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30;\n    out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31;\n    out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32;\n    out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33;\n    return out;\n}\n\n/**\n * Alias for {@link mat4.multiply}\n * @function\n */\nconst _multiply = multiply;\nexport { _multiply as multiply };\nexport const mul = multiply;\n\n/**\n * Translate a mat4 by the given vector\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the matrix to translate\n * @param {vec3} v vector to translate by\n * @returns {mat4} out\n */\nexport function translate(out, a, v) {\n    var x = v[0], y = v[1], z = v[2],\n        a00, a01, a02, a03,\n        a10, a11, a12, a13,\n        a20, a21, a22, a23;\n\n    if (a === out) {\n        out[12] = a[0] * x + a[4] * y + a[8] * z + a[12];\n        out[13] = a[1] * x + a[5] * y + a[9] * z + a[13];\n        out[14] = a[2] * x + a[6] * y + a[10] * z + a[14];\n        out[15] = a[3] * x + a[7] * y + a[11] * z + a[15];\n    } else {\n        a00 = a[0]; a01 = a[1]; a02 = a[2]; a03 = a[3];\n        a10 = a[4]; a11 = a[5]; a12 = a[6]; a13 = a[7];\n        a20 = a[8]; a21 = a[9]; a22 = a[10]; a23 = a[11];\n\n        out[0] = a00; out[1] = a01; out[2] = a02; out[3] = a03;\n        out[4] = a10; out[5] = a11; out[6] = a12; out[7] = a13;\n        out[8] = a20; out[9] = a21; out[10] = a22; out[11] = a23;\n\n        out[12] = a00 * x + a10 * y + a20 * z + a[12];\n        out[13] = a01 * x + a11 * y + a21 * z + a[13];\n        out[14] = a02 * x + a12 * y + a22 * z + a[14];\n        out[15] = a03 * x + a13 * y + a23 * z + a[15];\n    }\n\n    return out;\n}\n\n\n/**\n * Scales the mat4 by the dimensions in the given vec3 not using vectorization\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the matrix to scale\n * @param {vec3} v the vec3 to scale the matrix by\n * @returns {mat4} out\n **/\nexport function scale (out, a, v) {\n    var x = v[0], y = v[1], z = v[2];\n\n    out[0] = a[0] * x;\n    out[1] = a[1] * x;\n    out[2] = a[2] * x;\n    out[3] = a[3] * x;\n    out[4] = a[4] * y;\n    out[5] = a[5] * y;\n    out[6] = a[6] * y;\n    out[7] = a[7] * y;\n    out[8] = a[8] * z;\n    out[9] = a[9] * z;\n    out[10] = a[10] * z;\n    out[11] = a[11] * z;\n    out[12] = a[12];\n    out[13] = a[13];\n    out[14] = a[14];\n    out[15] = a[15];\n    return out;\n}\n\n\n\n\n/**\n * Generates a orthogonal projection matrix with the given bounds\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} left Left bound of the frustum\n * @param {number} right Right bound of the frustum\n * @param {number} bottom Bottom bound of the frustum\n * @param {number} top Top bound of the frustum\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function ortho(out, left, right, bottom, top, near, far) {\n    var lr = 1 / (left - right),\n        bt = 1 / (bottom - top),\n        nf = 1 / (near - far);\n    out[0] = -2 * lr;\n    out[1] = 0;\n    out[2] = 0;\n    out[3] = 0;\n    out[4] = 0;\n    out[5] = -2 * bt;\n    out[6] = 0;\n    out[7] = 0;\n    out[8] = 0;\n    out[9] = 0;\n    out[10] = 2 * nf;\n    out[11] = 0;\n    out[12] = (left + right) * lr;\n    out[13] = (top + bottom) * bt;\n    out[14] = (far + near) * nf;\n    out[15] = 1;\n    return out;\n}\n\n\nexport function console_log(m, name = 'matrix_nm') {\n    console.log(name + ':')\n    //console.log('{0}{1}{2}{3}'.format(m[0], m[1], m[2], m[3]))\n    //console.log(\"Hello, {name}, are you feeling {adjective}?\".formatUnicorn({ name: \"Gabriel\", adjective: \"OK\" }));\n    //console.log('${m[0], m[1], m[2], m[3]}'.format(m[0], m[1], m[2], m[3]))\n    console.log(m[0], m[1], m[2], m[3])\n    console.log(m[4], m[5], m[6], m[7])\n    console.log(m[8], m[9], m[10], m[11])\n    console.log(m[12], m[13], m[14], m[15])\n\n    //var test = '5'\n    //console.log(\n    //    m[0], m[1], m[2], m[3] + '\\n', '${m[0]}, ${m[1]}, ${m[2]}, ${m[3]}',\n    //)\n}\n\n\n\n\n\n\n\n\n///**\n\n// * Generates a perspective projection matrix with the given bounds.\n\n// * Passing null/undefined/no value for far will generate infinite projection matrix.\n\n// *\n\n// * @param {mat4} out mat4 frustum matrix will be written into\n\n// * @param {number} fovy Vertical field of view in radians\n\n// * @param {number} aspect Aspect ratio. typically viewport width/height\n\n// * @param {number} near Near bound of the frustum\n\n// * @param {number} far Far bound of the frustum, can be null or Infinity\n\n// * @returns {mat4} out\n\n// */\n\n//export function perspective(out, fovy, aspect, near, far) {\n\n//  let f = 1.0 / Math.tan(fovy / 2), nf;\n\n//  out[0] = f / aspect;\n\n//  out[1] = 0;\n\n//  out[2] = 0;\n\n//  out[3] = 0;\n\n//  out[4] = 0;\n\n//  out[5] = f;\n\n//  out[6] = 0;\n\n//  out[7] = 0;\n\n//  out[8] = 0;\n\n//  out[9] = 0;\n\n//  out[11] = -1;\n\n//  out[12] = 0;\n\n//  out[13] = 0;\n\n//  out[15] = 0;\n\n//  if (far != null && far !== Infinity) {\n\n//    nf = 1 / (near - far);\n\n//    out[10] = (far + near) * nf;\n\n//    out[14] = (2 * far * near) * nf;\n\n//  } else {\n\n//    out[10] = -1;\n\n//    out[14] = -2 * near;\n\n//  }\n\n//  return out;\n\n//}\n\n///**\n\n// * Generates a perspective projection matrix with the given field of view.\n\n// * This is primarily useful for generating projection matrices to be used\n\n// * with the still experiemental WebVR API.\n\n// *\n\n// * @param {mat4} out mat4 frustum matrix will be written into\n\n// * @param {Object} fov Object containing the following values: upDegrees, downDegrees, leftDegrees, rightDegrees\n\n// * @param {number} near Near bound of the frustum\n\n// * @param {number} far Far bound of the frustum\n\n// * @returns {mat4} out\n\n// */\n\n//export function perspectiveFromFieldOfView(out, fov, near, far) {\n\n//  let upTan = Math.tan(fov.upDegrees * Math.PI/180.0);\n\n//  let downTan = Math.tan(fov.downDegrees * Math.PI/180.0);\n\n//  let leftTan = Math.tan(fov.leftDegrees * Math.PI/180.0);\n\n//  let rightTan = Math.tan(fov.rightDegrees * Math.PI/180.0);\n\n//  let xScale = 2.0 / (leftTan + rightTan);\n\n//  let yScale = 2.0 / (upTan + downTan);\n\n//  out[0] = xScale;\n\n//  out[1] = 0.0;\n\n//  out[2] = 0.0;\n\n//  out[3] = 0.0;\n\n//  out[4] = 0.0;\n\n//  out[5] = yScale;\n\n//  out[6] = 0.0;\n\n//  out[7] = 0.0;\n\n//  out[8] = -((leftTan - rightTan) * xScale * 0.5);\n\n//  out[9] = ((upTan - downTan) * yScale * 0.5);\n\n//  out[10] = far / (near - far);\n\n//  out[11] = -1.0;\n\n//  out[12] = 0.0;\n\n//  out[13] = 0.0;\n\n//  out[14] = (far * near) / (near - far);\n\n//  out[15] = 0.0;\n\n//  return out;\n\n//}\n\n///**\n\n// * Generates a orthogonal projection matrix with the given bounds\n\n// *\n\n// * @param {mat4} out mat4 frustum matrix will be written into\n\n// * @param {number} left Left bound of the frustum\n\n// * @param {number} right Right bound of the frustum\n\n// * @param {number} bottom Bottom bound of the frustum\n\n// * @param {number} top Top bound of the frustum\n\n// * @param {number} near Near bound of the frustum\n\n// * @param {number} far Far bound of the frustum\n\n// * @returns {mat4} out\n\n// */\n\n//export function ortho(out, left, right, bottom, top, near, far) {\n\n//  let lr = 1 / (left - right);\n\n//  let bt = 1 / (bottom - top);\n\n//  let nf = 1 / (near - far);\n\n//  out[0] = -2 * lr;\n\n//  out[1] = 0;\n\n//  out[2] = 0;\n\n//  out[3] = 0;\n\n//  out[4] = 0;\n\n//  out[5] = -2 * bt;\n\n//  out[6] = 0;\n\n//  out[7] = 0;\n\n//  out[8] = 0;\n\n//  out[9] = 0;\n\n//  out[10] = 2 * nf;\n\n//  out[11] = 0;\n\n//  out[12] = (left + right) * lr;\n\n//  out[13] = (top + bottom) * bt;\n\n//  out[14] = (far + near) * nf;\n\n//  out[15] = 1;\n\n//  return out;\n\n//}\n\n\n","\"use strict\";\n\nclass Rectangle {\n    constructor(xmin, ymin, xmax, ymax)\n    {\n        this.xmin = xmin\n        this.ymin = ymin\n        this.xmax = xmax\n        this.ymax = ymax\n    }\n\n    width()\n    {\n        return this.xmax - this.xmin\n    }\n\n    height()\n    {\n        return this.ymax - this.ymin\n    }\n\n    toString()\n    {\n        return `new Rectangle(${this.xmin}, ${this.ymin}, ${this.xmax}, ${this.ymax})`\n    }\n\n    area()\n    {\n        return this.width() * this.height()\n    }\n\n    center()\n    {\n        return [this.xmin + this.width() * 0.5,\n                this.ymin + this.height() * 0.5]\n    }\n}\n\nexport default Rectangle\n","import { create, createvec3, vec3transform, multiply, invert, console_log } from './mat4';\nimport Rectangle from './rect';\nvar meter_to_pixel = 3779.5275590551; // 1 meter equals 3779.5275590551 pixels\n\n\n//import { log } from 'util';\n\n// TODO\n// - Aspect ratio / resize of viewport --> update transform\n// - Take into account the z-value of the slice\n// - Remove duplication inside functions\n\n// let = block scoped\n// var = global / function scoped\n\n\n\n\n//function world_square_matrix(box, ar) {\n//    // Returns transform matrix to go from world to normalized square\n//    // FIXME: aspect ratio - is NOT taken into account ??? !!!\n//    let sx = 2. / ((box.xmax - box.xmin) * ar)\n//    let sy = 2. / (box.ymax - box.ymin)\n//    let tx = -(box.xmax + box.xmin) / (box.xmax - box.xmin)\n//    let ty = -(box.ymax + box.ymin) / (box.ymax - box.ymin)\n//    let m = create()\n//    m[0] = sx\n//    m[5] = sy\n//    m[12] = tx\n//    m[13] = ty\n//    return m\n//}\n\n\nfunction square_viewport_matrix(box) {\n    // Returns transform matrix to go from normalized square to viewport\n    // FIXME: can overflow? better to first multiply with 1/2?\n    let sx = (box.xmax - box.xmin) * .5\n    let sy = (box.ymax - box.ymin) * .5\n    let tx = (box.xmax + box.xmin) * .5\n    let ty = (box.ymax + box.ymin) * .5\n    let m = create()\n    m[0] = sx\n    m[5] = sy\n    m[12] = tx\n    m[13] = ty\n    return m\n}\n\n// FIXME\n//\n// Check handedness of the 3D system and get it right + consistent!\n// https://github.com/g-truc/glm/blob/master/glm/gtc/matrix_transform.inl\n//\n// OrthoLH\n// OrthoRH\n\n\nclass Transform {\n    constructor(center_world, viewport_size, denominator) {\n\n        this.viewport_world = create(); //matrix: to transform a point from a viewport to the realworld\n        this.world_viewport = create(); //matrix: to transform a point from the realworld to a viewport \n        //\n        this.world_square = null;\n        this.square_viewport = null;\n        //\n        this.viewport = null; //e.g., xmin:0, ymin:0, xmax: 1200, ymax: 929\n\n        // set up initial transformation\n        this.initTransform(center_world, viewport_size, denominator)\n\n        this.snapped_step = Number.MAX_SAFE_INTEGER\n        this.snapped_St = denominator\n        //this.current_step = Number.MAX_SAFE_INTEGER\n    }\n\n    // fixme: rename -> initTransform\n    initTransform(center_world, viewport_size, denominator) {\n        // compute from the center of the world, the viewport size and the scale\n        // denominator how much of the world is visible\n        let cx = center_world[0],\n            cy = center_world[1]\n\n        // get half visible screen size in world units,\n        // when we look at it at this map scale (1:denominator)\n        let half_visible_screen = [\n            0.5 * viewport_size[0] / meter_to_pixel * denominator,\n            0.5 * viewport_size[1] / meter_to_pixel * denominator\n        ]\n        let xmin = cx - half_visible_screen[0],\n            xmax = cx + half_visible_screen[0],\n            ymin = cy - half_visible_screen[1],\n            ymax = cy + half_visible_screen[1]\n        // the size of the viewport \n        this.viewport = new Rectangle(0, 0, viewport_size[0], viewport_size[1])\n        // we arrive at what part of the world then is visible\n        // let visible_world = this.getVisibleWorld() //\n        let visible_world = new Rectangle(xmin, ymin, xmax, ymax)\n        // scaling/translating is then as follows:\n        this.update_world_square_viewport(visible_world, cx, cy)\n    }\n\n\n    pan(dx, dy) {\n        //console_log(this.square_viewport, 'this.square_viewport before')\n        //console.log('dx, dy:', dx, dy)\n        this.square_viewport[12] += dx\n        this.square_viewport[13] += dy\n\n        //console_log(this.square_viewport, 'this.square_viewport')\n        //console_log(this.world_square, 'this.world_square')\n\n        //e.g., viewport: 1200 x 929\n        //e.g., this.square_viewport changed by moving dx == 100 and dy == 50:\n        //  600         0       0       0\n        //    0     464.5       0       0\n        //    0         0       1       0\n        //  700     514.5       0       1\n        //e.g., this.world_square:\n        //    0.00006929133087396622      0                         0   0\n        //    0                           0.00008950447954703122    0   0\n        //    0                           0                         1   0\n        //  -12.938166618347168         -27.96834945678711          0   1\n        multiply(this.world_viewport, this.square_viewport, this.world_square)\n        //e.g., this.world_viewport:\n        //      0.04157479852437973     0                       0   0\n        //      0                       0.041574832051992416    0   0\n        //      0                       0                       1   0\n        //  -7062.89990234375      -12476.7978515625            0   1\n\n\n        //console_log(this.world_viewport, 'this.world_viewport')\n\n\n        invert(this.viewport_world, this.world_viewport)\n\n        // we arrive at what part of the world then is visible\n        let visible_world = this.getVisibleWorld() // new Rectangle(ll[0], ll[1], tr[0], tr[1])\n        let center = visible_world.center()\n        // scaling/translating is then as follows:\n        this.update_world_square_viewport(visible_world, center[0], center[1])\n    }\n\n    zoom(ssctree, zoom_factor, x, y, if_snap) {\n        //console.log(' ')\n        //let if_snap = true\n        //console.log('transform.js St before:', this.getScaleDenominator())\n        //console.log('transform.js factor:', zoom_factor)\n\n        let St_current = this.getScaleDenominator()\n        let current_step = ssctree.get_step_from_St(St_current) //current_step should be compute instantly because of aborting actions\n        this.compute_zoom_parameters(zoom_factor, x, y)\n        let St = this.getScaleDenominator()\n\n\n        //console.log('transform.js St_current:', St_current)\n        console.log('transform.js St:', St)\n        //console.log('transform.js St_current / St:', St_current / St)\n        //console.log('transform.js zoom_factor:', zoom_factor)\n\n        //console.log('transform.js ----------------:')\n        //console.log('transform.js St after:', this.getScaleDenominator())\n\n\n\n        let snapped_step = ssctree.get_step_from_St(St, if_snap, zoom_factor, current_step)\n        let time_factor = ssctree.get_time_factor(St, if_snap, zoom_factor, current_step)\n        let snapped_St = ssctree.get_St_from_step(snapped_step)\n        this.snapped_step = snapped_step\n        this.snapped_St = snapped_St\n\n        //this.current_step = snapped_step\n\n        console.log('transform.js snapped_step:', snapped_step)\n        console.log('transform.js snapped_St:', snapped_St)\n        //console.log('transform.js St / snapped_St:', St / snapped_St)\n        this.compute_zoom_parameters(St / snapped_St, x, y)\n        //let final_St = this.getScaleDenominator()\n        //console.log('transform.js final St:', final_St) \n        //console.log('transform.js final step:', ssctree.get_step_from_St(St, false))\n        return time_factor\n    }\n\n    compute_zoom_parameters(zoom_factor, x, y) {\n    //zoom(ssctree, factor, x, y) {\n        //console.log('transform.js test')\n\n        var tmp = create()\n        // 1. translate\n        {\n            let eye = create()\n            eye[12] = -x\n            eye[13] = -y\n            multiply(tmp, eye, this.square_viewport)\n        }\n        // 2. scale\n        {\n            let eye = create()\n            eye[0] = zoom_factor\n            eye[5] = zoom_factor\n            multiply(tmp, eye, tmp)\n        }\n        // 3. translate back\n        {\n            let eye = create()\n            eye[12] = x\n            eye[13] = y\n            multiply(tmp, eye, tmp)\n        }\n        //this.square_viewport = tmp;\n        multiply(this.world_viewport, tmp, this.world_square)\n        invert(this.viewport_world, this.world_viewport)\n        // we arrive at what part of the world then is visible\n        let visible_world = this.getVisibleWorld() // new Rectangle(ll[0], ll[1], tr[0], tr[1])\n        let center = visible_world.center()\n        // scaling/translating is then as follows:\n        this.update_world_square_viewport(visible_world, center[0], center[1])\n    }\n\n    update_world_square_viewport(visible_world, cx, cy) {\n\n        let scale = [2. / visible_world.width(), 2. / visible_world.height()]\n        let translate = [-scale[0] * cx, -scale[1] * cy]\n        // by means of which we can calculate a world -> ndc square matrix\n        let world_square = create()\n        world_square[0] = scale[0]\n        world_square[5] = scale[1]\n        world_square[12] = translate[0]\n        world_square[13] = translate[1]\n        this.world_square = world_square\n\n        //console.log(\"INITIAL world square\" + world_square);\n        // and given the size of the viewport we can set up ndc square -> viewport matrix\n\n\n        //console.log(this.viewport, 'this.viewport')\n\n        //e.g., this.viewport:  xmin: 0, ymin: 0, xmax: 1200, ymax: 929\n        //e.g., this.square_viewport obtained from function square_viewport_matrix:\n        //  600         0       0       0\n        //    0     464.5       0       0\n        //    0         0       1       0\n        //  600     464.5       0       1\n        this.square_viewport = square_viewport_matrix(this.viewport)\n        //console_log(this.square_viewport, 'this.square_viewport')\n\n        // and going from one to the other is then the concatenation of the 2 (and its inverse)\n        this.updateViewportTransform()\n        //console.log('ll: ' + ll + \" \" + this.viewport.xmin + \" \" + this.viewport.ymin);\n        //console.log('tr: ' + tr + \" \" + this.viewport.xmax + \" \" + this.viewport.ymax);\n    }\n\n\n\n    backward(vec3) {\n        let result = createvec3()\n        vec3transform(result, vec3, this.viewport_world)\n        return result\n    }\n\n    updateViewportTransform() {\n        // and going from one to the other is then the concatenation of the 2 (and its inverse)\n        //        console.log('square_viewport', this.square_viewport)\n        //        console.log('world_square', this.world_square)\n\n        multiply(this.world_viewport, this.square_viewport, this.world_square)\n        invert(this.viewport_world, this.world_viewport)\n    }\n\n    getVisibleWorld() {\n        //console.log(\"visibleWorld in transform.js\")\n        var ll = this.backward([this.viewport.xmin, this.viewport.ymin, 0.0]); //e.g., this.viewport.xmin == 0; ll[0] == 170625\n        var tr = this.backward([this.viewport.xmax, this.viewport.ymax, 0.0]); //e.g., this.viewport.xmax == 1200\n\n        // we arrive at what part of the world then is visible\n        return new Rectangle(ll[0], ll[1], tr[0], tr[1])\n    }\n\n    getCenter() {\n        //console.log(\"getCenter in transform.js\")\n        var center = this.backward([\n            this.viewport.xmin + (this.viewport.xmax - this.viewport.xmin) * 0.5,\n            this.viewport.ymin + (this.viewport.ymax - this.viewport.ymin) * 0.5, 0.0]);\n        return center\n    }\n\n    getScaleDenominator() {\n        let viewport_in_meter = new Rectangle(0, 0,\n            this.viewport.width() / meter_to_pixel,\n            this.viewport.height() / meter_to_pixel)\n        let world_in_meter = this.getVisibleWorld()\n        let St = Math.sqrt(world_in_meter.area() / viewport_in_meter.area())\n        return St\n    }\n\n\n\n}\n\nexport default Transform\n","// FIXME: rename draw to renderFunc ?\n\nclass DrawProgram {\n    constructor(gl, vertexShaderText, fragmentShaderText) {\n\n        const vertexShader = loadShader(gl, gl.VERTEX_SHADER, vertexShaderText);\n        const fragmentShader = loadShader(gl, gl.FRAGMENT_SHADER, fragmentShaderText);\n\n        // Create program: attach, link, validate, detach, delete\n        const shaderProgram = gl.createProgram();\n        gl.attachShader(shaderProgram, vertexShader);\n        gl.attachShader(shaderProgram, fragmentShader);\n        gl.linkProgram(shaderProgram);\n        if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)) {\n            console.error('ERROR linking program!', gl.getProgramInfoLog(shaderProgram));\n            return;\n        }\n        gl.validateProgram(shaderProgram);\n        if (!gl.getProgramParameter(shaderProgram, gl.VALIDATE_STATUS)) {\n            console.error('ERROR validating program!', gl.getProgramInfoLog(shaderProgram));\n            return;\n        }\n\n        this.shaderProgram = shaderProgram;\n        this.gl = gl;\n\n        // FIXME: when to call these detach/delete's? After succesful compilation?\n        // gl.detachShader(this.shaderProgram, vertexShader);\n        // gl.detachShader(this.shaderProgram, fragmentShader);\n        // gl.deleteShader(vertexShader);\n        // gl.deleteShader(fragmentShader);\n\n        // creates a shader of the given type, uploads the source and\n        // compiles it.\n        function loadShader(gl, type, source) {\n\n            const shader = gl.createShader(type);\n            gl.shaderSource(shader, source); // Send the source of the shader\n            gl.compileShader(shader); // Compile the shader program\n\n            // See if it compiled successfully\n            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n                console.error('ERROR occurred while compiling the shaders: ' + gl.getShaderInfoLog(shader));\n                gl.deleteShader(shader);\n                return null;\n            }\n\n            return shader;\n        }\n    }\n\n    _specify_data_for_shaderProgram(gl, shaderProgram, attribute_name, itemSize, stride, offset) {\n\n        const attrib_location = gl.getAttribLocation(shaderProgram, attribute_name);\n        gl.enableVertexAttribArray(attrib_location);\n        gl.vertexAttribPointer(\n            attrib_location,    // * Attribute location\n            itemSize,           // * Number of components per attribute ????? \n            gl.FLOAT,           // * Type of elements\n            false,              // * Is normalized?\n            stride,             // * stride \n            offset              // * Offset from the beginning of \n        );\n\n    }\n\n}\n\n\n\n\nclass ImageTileDrawProgram extends DrawProgram \n{\n    constructor(gl)\n    {\n        let vertexShaderText = `\n            precision highp float;\n\n            attribute vec3 vertexPosition_modelspace;\n            attribute vec2 aTextureCoord;\n\n            uniform mat4 M;\n\n            varying highp vec2 vTextureCoord;\n\n            void main()\n            {\n              gl_Position = M * vec4(vertexPosition_modelspace, 1.0);\n              vTextureCoord = aTextureCoord;\n            }\n        `\n\n        let fragmentShaderText = `\n            precision highp float;\n\n            varying highp vec2 vTextureCoord;\n\n            uniform sampler2D uSampler;\n            \n            void main()\n            {\n              gl_FragColor = texture2D(uSampler, vTextureCoord);\n            }\n        `\n\n        super(gl, vertexShaderText, fragmentShaderText)\n    }\n\n//    draw(matrix, tilecontent)\n    draw_tile(matrix, tile) {\n        if (tile.content.buffer === null)\n        {\n            return;\n        }\n\n        let gl = this.gl;\n        gl.useProgram(this.shaderProgram);\n        gl.bindBuffer(gl.ARRAY_BUFFER, tile.content.buffer); \n\n        // FIXME: better to store with bucket how the layout of the mesh is?\n        const positionAttrib = gl.getAttribLocation(this.shaderProgram, 'vertexPosition_modelspace');\n        // gl.vertexAttribPointer(positionAttrib, 3, gl.FLOAT, false, 24, 0);\n        gl.vertexAttribPointer(positionAttrib, 3, gl.FLOAT, false, 0, 0);\n        gl.enableVertexAttribArray(positionAttrib);\n\n        {\n            let M = gl.getUniformLocation(this.shaderProgram, 'M');\n            gl.uniformMatrix4fv(M, false, matrix);\n        }\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, tile.content.textureCoordBuffer)\n        const textureAttrib = gl.getAttribLocation(this.shaderProgram, 'aTextureCoord');\n        gl.vertexAttribPointer(textureAttrib, 2, gl.FLOAT, false, 0, 0);\n        gl.enableVertexAttribArray(textureAttrib);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, tile.content.texture);\n\n        const uSampler = gl.getUniformLocation(this.shaderProgram, 'uSampler');\n        gl.uniform1i(uSampler, 0);\n\n        gl.enable(gl.BLEND);\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n//        gl.disable(gl.BLEND);\n        gl.enable(gl.DEPTH_TEST);\n        gl.drawArrays(gl.TRIANGLES, 0, tile.content.buffer.numItems); // FIXME!\n    }\n}\n\n\n\n\nclass LineDrawProgram extends DrawProgram {\n    constructor(gl) {\n\n        let vertexShaderText = `\nprecision highp float;\n\nattribute vec2 displacement;\nattribute vec4 vertexPosition_modelspace;\nuniform mat4 M;\nuniform float near;\nuniform float half_width_reality;\n\nvoid main()\n{\n    vec4 pos = vertexPosition_modelspace;\n\n    if (pos.z <= near && pos.w > near)\n    {\n        pos.x +=  displacement.x * half_width_reality;\n        pos.y +=  displacement.y * half_width_reality;\n        gl_Position = M * vec4(pos.xyz, 1.0);\n\n    } else {\n        gl_Position = vec4(-10.0,-10.0,-10.0,1.0);\n        return;\n    }\n}\n`;\n\n        let fragmentShaderText = `\nprecision mediump float;\nuniform vec4 uColor;\n\nvoid main()\n{\n    gl_FragColor = uColor; // color of the lines\n}\n`;\n\n        super(gl, vertexShaderText, fragmentShaderText)\n\n        this.colors = [[141, 211, 199]\n            , [190, 186, 218]\n            , [251, 128, 114]\n            , [128, 177, 211]\n            , [253, 180, 98]\n            , [179, 222, 105]\n            , [252, 205, 229]\n            , [217, 217, 217]\n            , [188, 128, 189]\n            , [204, 235, 197]\n        ].map(x => { return [x[0] / 255., x[1] / 255., x[2] / 255.]; });\n    }\n\n\n    draw_tile(matrix, tile, near_St, boundary_width_screen) {\n        let gl = this.gl;\n        let shaderProgram = this.shaderProgram;\n        let triangleVertexPosBufr = tile.content.line_triangleVertexPosBufr;\n        let displacementBuffer = tile.content.displacementBuffer;\n\n        if (triangleVertexPosBufr === null) {\n            return;\n        }\n        gl.useProgram(shaderProgram);\n\n        // void vertexAttribPointer(GLuint index, GLint size, GLenum type, GLboolean normalized, GLsizei stride, GLintptr offset)\n        // size is the number of components per attribute. For example, with RGB colors, it would be 3; and with an\n        // alpha channel, RGBA, it would be 4. If we have location data with (x,y,z) attributes, it would be 3; and if we\n        // had a fourth parameter w, (x,y,z,w), it would be 4. Texture parameters (s,t) would be 2. type is the datatype,\n        // stride and offset can be set to the default of 0 for now and will be reexamined in Chapter 9 when we discuss\n        // interleaved arrays.\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, triangleVertexPosBufr);\n        this._specify_data_for_shaderProgram(gl, shaderProgram, 'vertexPosition_modelspace', 4, 0, 0);\n\n        gl.bindBuffer(gl.ARRAY_BUFFER, displacementBuffer);\n        this._specify_data_for_shaderProgram(gl, shaderProgram, 'displacement', 2, 0, 0);\n\n        // the unit of boundary_width is mm; 1 mm equals 3.7795275590551 pixels\n        // FIXME: MM: at which amount of dots per inch has this been calculated?\n\n         // FIXME: settings/view\n//        let boundary_width_screen = 0.2;\n        //var boundary_width_screen = parseFloat(document.getElementById('boundary_width_slider').value);\n        // The unit of the map must be meter!!!\n        var half_width_reality = boundary_width_screen * near_St[1] / 1000 / 2;\n//        if (width_increase > 0)\n//        {\n//            half_width_reality *= width_increase;\n//        }\n\n        {\n            let M_location = gl.getUniformLocation(shaderProgram, 'M');\n            gl.uniformMatrix4fv(M_location, false, matrix);\n\n            let near_location = gl.getUniformLocation(shaderProgram, 'near');\n            gl.uniform1f(near_location, near_St[0]);\n\n            let half_width_reality_location = gl.getUniformLocation(shaderProgram, 'half_width_reality');\n            gl.uniform1f(half_width_reality_location, half_width_reality);\n            var c = [0.0, 0.0, 0.0]; // black\n//            if (width_increase <= 0)\n//            {\n//                // var c = this.colors[tile.id % this.colors.length];\n//                c = [1.0, 1.0, 1.0]; // white\n//            }\n            var color_location = gl.getUniformLocation(shaderProgram, 'uColor');\n            gl.uniform4f(color_location, c[0], c[1], c[2], 1.0);\n        }\n\n        // Set clear color to white, fully opaque\n        // gl.clearColor(1., 1., 1., 1.0);\n        // gl.clearDepth(1.0); // Clear everything\n\n        // gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); // Clear the color buffer with specified clear color\n        // gl.clear(gl.COLOR_BUFFER_BIT)\n\n        // gl.disable(gl.BLEND);\n        //gl.enable(gl.BLEND); // FIXME: needed?\n        gl.disable(gl.DEPTH_TEST);\n\n        // gl.enable(gl.CULL_FACE);\n         gl.disable(gl.CULL_FACE); // FIXME: should we be explicit about face orientation and use culling?\n\n        // gl.cullFace(gl.BACK);\n        // gl.cullFace(gl.FRONT);\n        // gl.cullFace(gl.FRONT_AND_BACK);\n\n        gl.drawArrays(\n            gl.TRIANGLES, // kind of primitives to render; e.g., POINTS, LINES\n            0,            // Specifies the starting index in the enabled arrays.\n            triangleVertexPosBufr.numItems // Specifies the number of indices to be rendered.\n        );\n    }\n}\n\n\n\nclass PolygonDrawProgram extends DrawProgram {\n    constructor(gl) {\n        let vertexShaderText = `\nprecision highp float;\n\nattribute vec3 vertexPosition_modelspace;\nattribute vec3 vertexColor;\nuniform mat4 M;\nvarying vec4 fragColor;\nuniform float opacity;\n\nvoid main()\n{\n    fragColor = vec4(vertexColor, opacity);\n    gl_Position = M * vec4(vertexPosition_modelspace, 1);\n}\n`;\n        let fragmentShaderText = `\nprecision mediump float;\n\nvarying vec4 fragColor;\nvoid main()\n{\n    gl_FragColor = vec4(fragColor);\n}\n`;\n        super(gl, vertexShaderText, fragmentShaderText)\n    }\n\n\n    draw_tile(matrix, tile, ssctree) {\n        // guard: if no data in the tile, we will skip rendering\n        let triangleVertexPosBufr = tile.content.polygon_triangleVertexPosBufr;\n        if (triangleVertexPosBufr === null) {\n            //console.log('render.js draw_tile, triangleVertexPosBufr:', triangleVertexPosBufr)\n            return;\n        }\n        // render\n        let gl = this.gl;\n        let shaderProgram = this.shaderProgram;\n        gl.useProgram(shaderProgram);\n        gl.bindBuffer(gl.ARRAY_BUFFER, triangleVertexPosBufr);\n\n        //stride = 24: each of the six values(x, y, z, r_frac, g_frac, b_frac) takes 4 bytes\n        //itemSize = 3: x, y, z;   \n        this._specify_data_for_shaderProgram(gl, shaderProgram, 'vertexPosition_modelspace', 3, 24, 0);\n        //itemSize = 3: r_frac, g_frac, b_frac;   offset = 12: the first 12 bytes are for x, y, z\n        this._specify_data_for_shaderProgram(gl, shaderProgram, 'vertexColor', 3, 24, 12);\n\n        {\n            let M_location = gl.getUniformLocation(shaderProgram, 'M');\n            gl.uniformMatrix4fv(M_location, false, matrix);\n\n            let opacity_location = gl.getUniformLocation(shaderProgram, 'opacity');\n            gl.uniform1f(opacity_location, ssctree.opacity);\n        }\n\n        gl.enable(gl.CULL_FACE);\n        //gl.disable(gl.CULL_FACE); // FIXME: should we be explicit about face orientation and use culling?\n\n        //bln_glback = true\n        gl.cullFace(gl.FRONT); //by default, draw the front faces\n        if (ssctree.bln_glfront == false) {\n            gl.cullFace(gl.BACK);\n        }\n\n        gl.enable(gl.DEPTH_TEST); //by default, do depth test\n        if (ssctree.bln_depth_test == false) {\n            gl.disable(gl.DEPTH_TEST);\n        }\n\n        //see https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/blendFunc\n        gl.enable(gl.BLEND)\n        if (ssctree.bln_blend == false) {\n            gl.disable(gl.BLEND)\n        }\n\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA) //make it transparent according to alpha value\n        gl.drawArrays(gl.TRIANGLES, 0, triangleVertexPosBufr.numItems);\n    }\n}\n\n\n//class ForegroundDrawProgram extends DrawProgram {\n//    constructor(gl) {\n//        let vertexShaderText = `\n//precision highp float;\n\n//attribute vec3 vertexPosition_modelspace;\n//attribute vec4 vertexColor;\n//uniform mat4 M;\n//varying vec4 fragColor;\n\n//void main()\n//{\n//    fragColor = vertexColor;\n//    gl_Position = M * vec4(vertexPosition_modelspace, 1);\n//}\n//`;\n//        let fragmentShaderText = `\n//precision mediump float;\n\n//varying vec4 fragColor;\n//void main()\n//{\n//    gl_FragColor = vec4(fragColor);\n//}\n//`;\n//        super(gl, vertexShaderText, fragmentShaderText)\n//    }\n\n//    draw_tile(matrix, tile) {\n//        // guard: if no data in the tile, we will skip rendering\n//        let triangleVertexPosBufr = tile.content.foreground_triangleVertexPosBufr;\n//        if (triangleVertexPosBufr === null) {\n//            return;\n//        }\n//        // render\n//        let gl = this.gl;\n//        let shaderProgram = this.shaderProgram;\n//        gl.useProgram(shaderProgram);\n//        gl.bindBuffer(gl.ARRAY_BUFFER, triangleVertexPosBufr);\n\n//        //stride = 24: each of the six values(x, y, z, r_frac, g_frac, b_frac) takes 4 bytes\n//        //itemSize = 3: x, y, z;   \n//        this._specify_data_for_shaderProgram(gl, shaderProgram, 'vertexPosition_modelspace', 3, 28, 0);\n//        //itemSize = 3: r_frac, g_frac, b_frac;   offset = 12: the first 12 bytes are for x, y, z\n//        this._specify_data_for_shaderProgram(gl, shaderProgram, 'vertexColor', 4, 28, 12);\n\n//        {\n//            let M_location = gl.getUniformLocation(shaderProgram, 'M');\n//            gl.uniformMatrix4fv(M_location, false, matrix);\n//        }\n\n//        gl.enable(gl.CULL_FACE);\n//        //gl.disable(gl.CULL_FACE); // FIXME: should we be explicit about face orientation and use culling?\n\n//        //gl.cullFace(gl.BACK);\n//        gl.cullFace(gl.FRONT);\n//        // gl.cullFace(gl.FRONT_AND_BACK);\n\n//        gl.enable(gl.BLEND)\n//        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA) //make it transparent according to alpha value\n//        //gl.disable(gl.BLEND);\n//        //gl.enable(gl.DEPTH_TEST);\n//        gl.drawArrays(gl.TRIANGLES, 0, triangleVertexPosBufr.numItems);\n//    }\n//}\n\n\nexport class Renderer {\n    constructor(gl, ssctree_lt) {\n        this.gl = gl\n        this.ssctree_lt = ssctree_lt\n        this.settings = { boundary_width: 0.2 }\n\n        // construct programs once, at init time\n        this.programs = [\n            new PolygonDrawProgram(gl),\n            new LineDrawProgram(gl),\n            new ImageTileDrawProgram(gl)\n            //new ForegroundDrawProgram(gl)\n        ];\n    }\n\n    // addBucket(mesh)\n    // {\n    //     console.log('making new mesh')\n    //     let b = new Bucket(this.gl, mesh)\n    //     this.buckets.push(b)\n    //     // setTimeout(() => {\n    //     //     this.buckets.map(bucket => {\n    //     //         bucket.destroy()\n    //     //     })\n    //     // }, 15000)\n    // }\n\n\n\n    render_relevant_tiles(matrix, box3d, near_St) {\n        // FIXME: \n        // should a bucket have a method to 'draw' itself?\n        // e.g. by associating multiple programs with a bucket\n        // when the bucket is constructed?\n\n\n\n\n        this._clearColor()\n\n        this.ssctree_lt.forEach(ssctree => {\n\n            this._clearDepth()\n            if (ssctree.tree == null) { //before the tree is loaded, ssctree.tree == null\n                return\n            }\n            //console.log('')\n            //console.log('render.js ssctree.tree:', ssctree.tree)\n            //console.log('render.js ssctree.tree.box:', ssctree.tree.box)\n//            var z_low = ssctree.tree.box[2] - 0.001\n//            var z_high = ssctree.tree.box[5] - 0.001\n//            var z_plane = box3d[2]\n//            if (z_plane < z_low || z_plane >= z_high) {\n//                return\n//            }\n\n            //console.log('render.js ssctree.dataset.tree_root_file_nm:', ssctree.dataset.tree_root_file_nm)\n            //console.log('render.js box3d:', box3d)\n            //console.log('render.js near_St:', near_St)\n\n            var tiles = ssctree.get_relevant_tiles(box3d)\n            if (tiles.length > 0) {                \n                var polygon_draw_program = this.programs[0];\n                tiles.forEach(tile => {\n                    //            .filter(tile => {tile.}) // FIXME tile should only have polygon data\n                        polygon_draw_program.draw_tile(matrix, tile, ssctree);\n                    })\n\n                var image_tile_draw_program = this.programs[2];\n                tiles.filter(\n                        // tile should have image data\n                        tile => {\n                            return tile.texture !== null\n                        }\n                    )\n                    .forEach(tile => {\n                        image_tile_draw_program.draw_tile(matrix, tile);\n                    })\n\n\n                // If we want to draw lines twice -> thick line under / small line over\n                // we need to do this twice + move the code for determining line width here...\n                if (this.settings.boundary_width > 0) {\n                    var line_draw_program = this.programs[1];\n                    tiles.forEach(tile => {\n                            // FIXME: would be nice to specify width here in pixels.\n                            // bottom lines (black)\n                            // line_draw_program.draw_tile(matrix, tile, near_St, 2.0);\n                            // interior (color)\n                            line_draw_program.draw_tile(matrix, tile, near_St, this.settings.boundary_width);\n                        })\n                }\n\n\n\n            }\n\n            // this.buckets.forEach(bucket => {\n            //     this.programs[0].draw(matrix, bucket);\n            // })\n            // FIXME:\n            // in case there is no active buckets (i.e. all buckets are destroy()'ed )\n            // we should this.gl.clear()\n\n\n        })\n\n\n    }\n\n    _clearDepth()\n    {\n        let gl = this.gl;\n        // gl.clearColor(1.0, 1.0, 1.0, 1.0);\n        gl.clearDepth(1.0); // Clear everything\n//        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); // clear both color and depth buffer\n        gl.clear(gl.DEPTH_BUFFER_BIT);  // clear depth buffer\n    }\n\n    _clearColor()\n    {\n        let gl = this.gl;\n        gl.clearColor(1.0, 1.0, 1.0, 0.0);\n        gl.clear(gl.COLOR_BUFFER_BIT); // clear both color and depth buffer\n    }\n\n    setViewport(width, height) {\n        this.gl.viewport(0, 0, width, height);\n    }\n\n\n}\n","// FIXME: UNIFY TileContent and ImageTileContent by branching inside load()-method\n// on the file extension to be retrieved... (not super elegant)\n\n// This makes TileContent quite big class -> split in subclasses?\n\n\nlet isPowerOf2 = ((value) => { return (value & (value - 1)) == 0 })\n\nexport class TileContent {\n    constructor(msgbus, texture_root_href, worker_helper) {\n        this.msgbus = msgbus\n        this.worker_helper = worker_helper\n\n        // image tiles\n        this.texture_root_href = texture_root_href;\n        this.buffer = null;\n        this.texture = null;\n        this.textureCoordBuffer = null;\n\n        // ssc tiles\n        this.polygon_triangleVertexPosBufr = null;\n        this.line_triangleVertexPosBufr = null;\n        this.displacementBuffer = null;\n        //this.foreground_triangleVertexPosBufr = null;\n\n\n    }\n\n    load(url, gl) {\n        if (url.endsWith('obj') == true) {\n            this.load_ssc_tile(url, gl)\n        }\n        else if (url.endsWith('json') == true) {\n            this.load_image_tile(url, gl)\n        }\n        //else if (url.endsWith('geojson') == true) {\n        //    this.load_geojson_tile(url, gl)\n        //}\n        else {\n            console.error('unknown url type: ' + url)\n        }\n    }\n\n    load_ssc_tile(url, gl) {\n        this.worker_helper.send( //send is a function of class WorkerHelper (see above)\n            url, //e.g. /gpudemo/2020/03/merge/0.1/data/sscgen_smooth.obj\n            (data) => { //I call the function makeBuffers, this is a function used as a parameter\n                //console.log('')\n                //console.log('tilecontent.js load_ssc_tile, url:', url)\n                // upload received data to GPU\n\n                // buffer for triangles of polygons\n                // itemSize = 6: x, y, z, r_frac, g_frac, b_frac (see parse.js)\n                this.polygon_triangleVertexPosBufr = create_data_buffer(gl, new Float32Array(data[0]), 6)\n                //console.log('tilecontent.js load_ssc_tile, this.polygon_triangleVertexPosBufr:', this.polygon_triangleVertexPosBufr)\n                //if (this.polygon_triangleVertexPosBufr == null) {\n                //    console.log('tilecontent.js load_ssc_tile, url:', url)\n                //    console.log('tilecontent.js load_ssc_tile, polygon_triangleVertexPosBufr:', polygon_triangleVertexPosBufr)\n                //    console.log('tilecontent.js load_ssc_tile, data[0]:', data[0])\n                //}\n                //console.log('tiles.js url2:', url)\n\n\n                // buffer for triangles of boundaries\n                // itemSize = 4: x, y, z (step_low), w (step_high); e.g., start (see parse.js)\n                this.line_triangleVertexPosBufr = create_data_buffer(gl, new Float32Array(data[1]), 4)\n\n                // buffer for displacements of boundaries\n                // itemSize = 2: x and y; e.g., startl (see parse.js)\n                this.displacementBuffer = create_data_buffer(gl, new Float32Array(data[2]), 2)\n\n                //var foreground_data_array = new Float32Array([\n                //    186500, 312600, 0, 1, 0, 0, 0.5,\n                //    186700, 311800, 0, 0, 0, 1, 0.5,\n                //    186200, 311800, 0, 0, 1, 0, 0.5]) //clockwise\n                //this.foreground_triangleVertexPosBufr = create_data_buffer(gl, foreground_data_array, 7)\n\n\n                // notify we are ready\n                this.msgbus.publish('data.tile.loaded', 'tile.ready')\n\n                function create_data_buffer(gl, data_array, itemSize) {\n                    let data_buffer = gl.createBuffer();\n                    gl.bindBuffer(gl.ARRAY_BUFFER, data_buffer);\n                    gl.bufferData(gl.ARRAY_BUFFER, data_array, gl.STATIC_DRAW);\n                    data_buffer.itemSize = itemSize; //x, y, z, r_frac, g_frac, b_frac\n                    //console.log('tiles.js data_array.length:', data_array.length)\n                    data_buffer.numItems = data_array.length / itemSize;\n                    return data_buffer;\n                }\n\n            }\n        )\n    }\n\n\n\n    load_image_tile(href, gl) {\n        let f = () => {\n\n            // setup texture as placeholder for texture to be retrieved later\n            this.texture = gl.createTexture();\n            gl.bindTexture(gl.TEXTURE_2D, this.texture);\n            // Because images have to be download over the internet\n            // they might take a moment until they are ready.\n            // Until then put a single pixel in the texture so we can\n            // use it immediately. When the image has finished downloading\n            // we'll update the texture with the contents of the image.\n            const level = 0;\n            const internalFormat = gl.RGBA;\n            const width = 1;\n            const height = 1;\n            const border = 0;\n            const srcFormat = gl.RGBA;\n            const srcType = gl.UNSIGNED_BYTE;\n            const pixel = new Uint8Array([255, 255, 255, 0]);  // white\n            gl.texImage2D(gl.TEXTURE_2D, level, internalFormat,\n                width, height, border, srcFormat, srcType,\n                pixel);\n\n            this.textureCoordBuffer = gl.createBuffer();\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.textureCoordBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\n                0.0, 0.0,\n                0.0, 1.0,\n                1.0, 1.0,\n                0.0, 0.0,\n                1.0, 1.0,\n                1.0, 0.0\n            ]), gl.STATIC_DRAW);\n\n            fetch(href).then(r => { return r.json() })\n                .then(mesh => {\n                    this._process_image_tile(mesh, gl)\n                    // this.msgbus.publish('data', 'tile.loaded.triangles')\n                })\n                .catch(err => { console.error(err) })\n        }\n\n        f()\n        // q.add(f)\n\n        // let image = new Image()\n        // let now = performance.now()\n        // image.crossOrigin = \"\"\n        // image.src = 'https://geodata.nationaalgeoregister.nl/tiles/service/tms/1.0.0/brtachtergrondkaart/EPSG:28992/0/0/0.png'\n        // image.addEventListener('load', () => {\n        //     this.texture = gl.createTexture();\n        //     gl.bindTexture(gl.TEXTURE_2D, this.texture);         \n        //     gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n        //     console.log(performance.now() - now)\n        //     if (isPowerOf2(image.width) && isPowerOf2(image.height)) \n        //     {\n        //         gl.generateMipmap(gl.TEXTURE_2D);\n        //     }\n        //     else\n        //     {\n        //         gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        //         gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        //         gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        //     }\n        // })\n        /*\n        this.texture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n    \n        var now = performance.now();\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n    */\n        // let scope = this;\n        // let client = new XMLHttpRequest();\n        // client.open('GET', this.url, true);\n        // \"text\", \"\", \"arraybuffer\", \"json\" -- https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/responseType\n        // client.responseType = \"text\";  \n        // client.onreadystatechange = function()\n        // {\n        //     if (client.readyState === XMLHttpRequest.DONE && client.status === 200)\n        //     {\n        //         console.log('loaded tile ' + scope.url)\n        //         scope._process(client.response);\n        //         // var buf = new ArrayBuffer(client.response.length);\n        //         // buf = client.response;\n        //         // // Here we do transfer the buffer in a way that does not involve\n        //         // // copying the ArrayBuffer\n        //         // // Note, we do assume that this works, but as it has been added\n        //         // // to the spec later, this could not be implemented in a browser!\n        //         // postMessage(buf, [buf]);\n        //     }\n        //     // we close the worker process\n        //     // close();\n        // }\n        // client.send(null);\n    }\n\n    _process_image_tile(response, gl) {\n        let result = []\n\n        response.points.forEach(\n            point => result.push(...point)\n        )\n        // could also be: response.points.flat(1); ???\n        this._upload_image_tile_mesh(gl, new Float32Array(result))\n\n        /*\n        // using image object to retrieve the texture\n        let image = new Image()\n        image.crossOrigin = \"\"\n        image.src = this.texture_root_href + response.texture_href\n        image.addEventListener('load', \n            () => {\n                this.texture = gl.createTexture();\n                gl.bindTexture(gl.TEXTURE_2D, this.texture);\n                gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n                if (isPowerOf2(image.width) && isPowerOf2(image.height)) \n                {\n                    console.log('mipmapping')\n                    gl.generateMipmap(gl.TEXTURE_2D);\n                }\n                else\n                {\n                    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n                    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n                    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n                }\n                this.msgbus.publish('data.tile.loaded', 'tile.loaded.texture')\n            }\n        )\n        */\n        \n        // using createImageBitmap and fetch to retrieve the texture\n        fetch(this.texture_root_href + response.texture_href, { mode: 'cors' })\n            .then((response) => {\n                if (!response.ok) {\n                    throw response;\n                }\n\n                return response.blob();\n            })\n            .then((blob) => {\n                // Giving options does not work for Firefox (do we need to give all option fields?)\n                return createImageBitmap(blob\n                    // , \n                    // {\n                    // premultiplyAlpha: 'none',\n                    // colorSpaceConversion: 'none',\n                    // }\n                );\n            }).then((bitmap) => {\n                this.texture = gl.createTexture();\n                gl.bindTexture(gl.TEXTURE_2D, this.texture);\n                gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, bitmap);\n                if (isPowerOf2(bitmap.width) && isPowerOf2(bitmap.height)) {\n                    gl.generateMipmap(gl.TEXTURE_2D);\n                }\n                else {\n                    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n                    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n                    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n                }\n                this.msgbus.publish('data.tile.loaded', 'tile.loaded.texture')\n            }).catch(function (e) {\n                console.error(e);\n            });\n    }\n\n    _upload_image_tile_mesh(gl, mesh) {\n        this.buffer = gl.createBuffer();  //buffer is an object with a reference to the memory location on the GPU\n        // bind buffer\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.buffer);\n        // upload content to the GPU\n        gl.bufferData(gl.ARRAY_BUFFER, mesh, gl.STATIC_DRAW);\n        // remember number of triangles for this buffer\n        this.buffer.numItems = (mesh.length) / 3;\n        // do not keep the floatarray object alive\n        // now we have uploaded the triangles to the GPU\n        // FIXME: is this needed?\n        // this.buffer.buffer = null\n    }\n\n    destroy(gl) {\n        // clear buffers / textures\n        let buffers = [this.buffer, this.textureCoordBuffer, this.line_triangleVertexPosBufr,\n        this.displacementBuffer, this.polygon_triangleVertexPosBufr]\n        buffers.forEach(\n            buffer => {\n                if (buffer !== null) {\n                    gl.deleteBuffer(buffer)\n                    buffer = null\n                }\n            }\n        )\n        let textures = [this.texture]\n        textures.forEach(\n            texture => {\n                gl.deleteTexture(texture)\n                texture = null\n            }\n        )\n\n    }\n\n}\n","import { now } from \"./animate\"\nimport { TileContent } from \"./tilecontent\"\n//import { require } from \"./require\"\n//var SortedMap = require(\"collections/sorted-map\");\n//import { fromArray } from '@collectable/sorted-set';\n//import { fromArray } from '../node_modules/@collectable/sorted-set';\n//import Transform from './transform';\n//import { log } from \"util\";\n\n//import Rectangle from './rect';\n//var meter_to_pixel = 3779.5275590551; // 1 meter equals 3779.5275590551 pixels\n\n\n// FIXME:\n// [x] Remove retrieved property on SSCTree \n// [x] Unify ImageTileContent and TileContent into one class\n// [x] Make Renderer play nicely with the modifications\n// [x] Resurrect Evictor, with default strategy of removing old stuff\n// [ ] Make use of worker to retrieve ImageTiles\n// [x] Use logicalProcessors = window.navigator.hardwareConcurrency for creating the WorkerHelper Pool\n// [ ] Make retrieval more resilient against non-working server (e.g. ask again for tile content), \n//     while not overloading the server(queueing requests / abortcontroller.signal)\n// [ ] It should be possible to cancel unneeded requests that have not yet been retrieved (e.g. after user has zoomed)\n\n\n\n\n\nexport class SSCTree {\n    constructor(msgbus, dataset) {\n        this.msgbus = msgbus\n        this.tree = null\n        this.dataset = dataset\n        this.step_highs = null\n        // FIXME: as the pool of workers is owned by the ssctree, adding a new SSCTree makes again (many) more workers\n        // There should be just 1 pool of workers, e.g. in the map object, that is used by all\n        // SSCTrees for data retrieval -> also images should be retrieved by a\n        // worker for example\n\n        // pool of workers\n        let pool_size = window.navigator.hardwareConcurrency || 2;\n        this.worker_helpers = []\n        for (let i = 0; i< pool_size+1; i++) {\n            this.worker_helpers.push(new WorkerHelper())\n        }\n        console.log(pool_size + ' workers made')\n        this.helper_idx_current = -1\n\n        // FIXME: theses should be put in settings *per* SSCTree ?\n        this.bln_glfront = false  //by default, draw the front faces\n        this.bln_depth_test = true //by default, do depth test\n        this.bln_blend = false\n        this.opacity = 1 //by default, opaque (not transparent)\n\n    }\n\n    load() {\n        //\n        // FIXME: convert to worker that does this\n        // \n        // fetch('nl/tree_max9_fanout10_9.json')\n\n        //we specify folder 'dist_test', 'dist_buchholz_greedy', or 'dist_buchholz_astar' in sscview-js\\rollup.config.js\n        //let data_folder = 'data/';\n//        let jsonfile = 'nodes.json';\n        //let jsonfile = 'tree_buchholz.json';\n        //let jsonfile = 'tree.json';\n        //console.log('fetching root' + this.dataset.tree_root_href + this.dataset.tree_root_file_nm)\n\n        //e.g., this.dataset.tree_root_href: '/data/'\n        //e.g., this.dataset.tree_root_file_nm: 'tree.json'\n        //e.g., this.dataset.step_event_nm: 'step_event.json'\n        var step_highs = null\n        var if_snap = false\n        var step_event_nm = 'step_event_nm'\n        if (step_event_nm in this.dataset) {\n            if_snap = true\n            fetch(this.dataset.tree_root_href + this.dataset[step_event_nm])\n                .then(r => {\n                    step_highs = [0] //if the file exists, we will do parallel merging\n                    return r.json()\n                })\n                .then(step_eventdiff_dt => {\n                    var current_face_num = step_eventdiff_dt.face_num\n                    var parallel_param = step_eventdiff_dt.parallel_param\n                    var step_diff_ltlt = step_eventdiff_dt.step_eventdiff\n                    var diff_index = 0\n                    var step = 1\n                    while (current_face_num > 1) {\n                        var max_parallel = Math.ceil(current_face_num * parallel_param)\n                        var event_diff = 0\n                        if (diff_index < step_diff_ltlt.length && step_diff_ltlt[diff_index][0] == step) {\n                            event_diff = step_diff_ltlt[diff_index][1]\n                            diff_index += 1\n                        }\n                        var eventnum = max_parallel - event_diff\n                        step_highs.push(step_highs[step_highs.length - 1] + eventnum)\n\n                        step += 1\n                        current_face_num -= eventnum\n                    } \n\n                    //console.log('ssctree.js step_diff_ltlt.length:', step_diff_ltlt.length)\n                })\n                .then(() => {\n                    this.step_highs = step_highs\n                    //this.msgbus.publish('data.step_highs.loaded')\n                    console.log('ssctree.js step_highs:', step_highs)\n                })\n                .catch(() => {\n                    this.step_highs = null\n                })\n        }\n\n        fetch(this.dataset.tree_root_href + this.dataset.tree_root_file_nm)\n            .then(r => {\n                return r.json()\n            })\n            .then(tree => {  //tree: the content in the json file\n                this.tree = tree\n                //let box3d = tree.box;\n                //tree.center2d = [(box3d[0] + box3d[3]) / 2, (box3d[1] + box3d[4]) / 2]\n                let dataelements = obtain_dataelements(this.tree)  //dataelements recorded in .json file\n                dataelements.forEach(element => { //originally, each element has attributes \"id\", \"box\", \"info\"\n                    element.content = null\n                    element.last_touched = null\n                    element.url = this.dataset.tile_root_href + element.href  //e.g., element.href: node02145.obj\n                    console.log('ssctree.js element.href:', element.href)\n                    element.loaded = false;\n                })\n            })\n            .then(() => {\n                // Notify via PubSub that tree has loaded \n                // (this re-renders the map if not already rendering)\n                this.msgbus.publish('data.tree.loaded', 'tree.ready')\n            })\n            .catch(err => {\n                console.error(err)\n            })\n\n        return if_snap\n    }\n\n    // FIXME: a tree can load other trees, however, the property .uri has been renamed in other parts of the code\n    // when we have made new tree serialization for tiles, we should change the code here!\n    load_subtree(node) {\n        fetch(this.dataset.tree_root_href + node.uri) // FIXME: was: node.href\n            .then(r => {\n                return r.json()\n            })\n            .then(j => {\n\n                node.children = j.children;\n                let dataelements = obtain_dataelements(node)  //dataelements recorded in .json file\n                dataelements.forEach(element => { //originally, each element has attributes \"id\", \"box\", \"info\"\n                    element.content = null\n                    element.last_touched = null\n                    //e.g., element.info: 10/502/479.json\n                    element.url = this.dataset.tile_root_href + element.info // FIXME:  was: element.href\n                    //console.log('ssctree.js element.info:', element.info)\n                    element.loaded = false;\n                })\n\n                this.msgbus.publish('data.tree.loaded', 'tree.ready')\n            })\n            .catch(err => {\n                console.error(err)\n            })\n    }\n\n    fetch_tiles(box3d, gl) {\n        if (this.tree === null) { return }\n        //console.log('ssctree.js fetch_tiles, this.dataset.tree_root_file_nm 1:', this.dataset.tree_root_file_nm)\n        //console.log('')\n        //console.log('ssctree.js fetch_tiles, this.tree:', this.tree)\n        //console.log('ssctree.js fetch_tiles, box3d:', box3d)\n        //e.g., this.tree: the content in file tree_smooth.json\n        let subtrees = obtain_overlapped_subtrees(this.tree, box3d)\n        subtrees.map(node => {\n            this.load_subtree(node)\n        })\n\n        let overlapped_dataelements = obtain_overlapped_dataelements(this.tree, box3d)\n\n        let to_retrieve = [];\n        overlapped_dataelements.map(elem => {\n            if (elem.loaded === false) {\n                to_retrieve.push(elem);\n            }\n        })\n\n        // sort the tiles via the distance from center of the box\n        // decorate-sort-undecorate based on distance:\n        //      2D center of viewport -- 2D center of bottom of tile\n        to_retrieve = to_retrieve.map(\n            elem => {\n                return [distance2d(elem.box, box3d), elem]\n            }\n        )\n        to_retrieve.sort(\n            (a, b) => { \n                    if (a[0] < b[0]) { return -1 }\n                    else if (a[0] > b[0]) { return 1 }\n                    else {return 0}\n            }\n        )\n        to_retrieve = to_retrieve.map(\n            elem => {return elem[1]}\n        )\n\n\n        //this.dataset\n        //console.log('ssctree.js fetch_tiles, this.dataset.tree_root_file_nm:', this.dataset.tree_root_file_nm)\n        //console.log('ssctree.js fetch_tiles, to_retrieve:', to_retrieve)\n\n        // schedule tiles for retrieval\n        to_retrieve.map(elem => {\n            this.helper_idx_current = (this.helper_idx_current + 1) % this.worker_helpers.length\n            let content = new TileContent(\n                this.msgbus,\n                this.dataset.texture_root_href,\n                this.worker_helpers[this.helper_idx_current]\n            )\n            content.load(elem.url, gl) //e.g., elem.url = /gpudemo/2020/03/merge/0.1/data/sscgen_smooth.obj\n            //console.log('ssctree.js fetch_tiles, this.helper_idx_current:', this.helper_idx_current)\n            //console.log('ssctree.js fetch_tiles, content.polygon_triangleVertexPosBufr:', content.polygon_triangleVertexPosBufr)\n            \n            elem.content = content\n            elem.loaded = true\n            elem.last_touched = now()\n            // FIXME: is this really 'retrieved' ? Or more, scheduled for loading ?\n        })\n\n    }\n\n    get_relevant_tiles(box3d) {\n        if (this.tree === null) { return [] }\n\n        let overlapped_dataelements = obtain_overlapped_dataelements(this.tree, box3d)\n        return overlapped_dataelements\n            .map(elem => { // set for each tile to be rendered the last accessed time\n                elem.last_touched = now();\n                return elem\n            })\n    }\n\n    get_step_from_St(St, if_snap = false, zoom_factor = 1, current_step = Number.MAX_SAFE_INTEGER) {\n        \n        // FIXME: these 2 variables should be adjusted\n        //         based on which tGAP is used...\n        // FIXME: this step mapping should move to the data side (the tiles)\n        //         and be kept there (for every dataset visualized on the map)\n        // FIXME: should use this.getScaleDenominator()\n\n        // let Sb = 48000  // (start scale denominator)\n        // let total_steps = 65536 - 1   // how many generalization steps did the process take?\n\n        //let Sb = 24000  // (start scale denominator)\n        //let total_steps = 262144 - 1   // how many generalization steps did the process take?\n\n        if (this.tree === null)\n        {\n             return 0\n        }\n        //console.log('')\n\n        // reduction in percentage\n        let reductionf = 1 - Math.pow(this.tree.metadata.start_scale_Sb / St, 2)\n        console.log('ssctree.js reductionf:', reductionf)\n        let step = this.tree.metadata.no_of_objects_Nb * reductionf //step is not necessarily an integer\n        let snapped_step = step\n        let step_highs = this.step_highs\n        if (if_snap == true\n            && step_highs != null\n            && step > step_highs[0] - 0.001\n            && step < step_highs[step_highs.length - 1] + 0.001 //without this line, the map will stop zooming out when at the last step\n        ) {\n            //console.log('ssctree.js step_highs:', step_highs)\n            //console.log('ssctree.js step:', step)\n            \n\n            let current_step_index = snap_to_existing_stephigh(current_step, step_highs)\n            if (Math.abs(current_step - step_highs[current_step_index]) < 0.001) {\n                current_step = step_highs[current_step_index]\n            }\n\n\n            //if we scroll too little, the map doesn't zoom because of the snapping.\n            //we force snapping for at least one step. \n            //let snapped_St = this.get_St_from_step(step_highs[step_index])\n            //console.log('ssctree.js normal_step_diff:', normal_step_diff)\n            //console.log('ssctree.js current_step:', current_step)\n            //console.log('ssctree.js step_highs[step_index]:', step_highs[step_index])\n            let snapped_index = snap_to_existing_stephigh(step, step_highs)\n            snapped_step = step_highs[snapped_index]\n\n\n\n            if (current_step != Number.MAX_SAFE_INTEGER) {\n                if (zoom_factor < 1 //zoom out\n                    && snapped_step <= current_step) { //wrong direction because of snapping\n                    snapped_index += 1\n                }\n                else if (zoom_factor > 1 //zoom in\n                    && snapped_step >= current_step) { //wrong direction because of snapping\n                    snapped_index -= 1\n                }\n            }\n            else {\n                //do nothing\n            }\n\n            snapped_step = step_highs[snapped_index]\n\n            //console.log('ssctree.js new step:', step)\n\n            //console.log('ssctree.js snapped_step:', snapped_step)\n        }\n\n        \n        console.log('ssctree.js new step:', step)\n        console.log('ssctree.js snapped_step:', snapped_step)\n\n        //return Math.max(0, step)\n        return snapped_step\n    }\n\n    get_time_factor(St, if_snap = false, zoom_factor = 1, current_step = Number.MAX_SAFE_INTEGER) {\n\n        if (this.tree === null || if_snap == false) {\n            return 1\n        }\n\n        // reduction in percentage\n        let reductionf = 1 - Math.pow(this.tree.metadata.start_scale_Sb / St, 2)\n        let step = this.tree.metadata.no_of_objects_Nb * reductionf //step is not necessarily an integer\n        let snapped_step = step\n        let step_highs = this.step_highs\n        let time_factor = 1\n        if (if_snap == true\n            && step_highs != null\n            && step > step_highs[0] - 0.001\n            && step < step_highs[step_highs.length - 1] + 0.001 //without this line, the map will stop zooming out when at the last step\n        ) {\n            //console.log('ssctree.js --------------------------------------')\n            //console.log('ssctree.js step_highs:', step_highs)\n            //console.log('ssctree.js current_step:', current_step)\n            let current_step_index = snap_to_existing_stephigh(current_step, step_highs)\n            if (Math.abs(current_step - step_highs[current_step_index]) < 0.001) {\n                current_step = step_highs[current_step_index]\n            }\n\n\n\n            //console.log('ssctree.js current_step_index:', current_step_index)\n\n            //console.log('ssctree.js step:', step)\n            //console.log('ssctree.js step_highs[current_step_index]:', step_highs[current_step_index])\n            let normal_step_diff = Math.abs(step - current_step)\n\n            let snapped_index = snap_to_existing_stephigh(step, step_highs)\n\n\n            //if we scroll too little, the map doesn't zoom because of the snapping.\n            //we force snapping for at least one step. \n\n            //let snapped_St = this.get_St_from_step(step_highs[step_index])\n            //console.log('ssctree.js normal_step_diff:', normal_step_diff)\n            //console.log('ssctree.js snapped_index:', snapped_index)\n            //console.log('ssctree.js step_highs[snapped_index]:', step_highs[snapped_index])\n            //console.log('ssctree.js zoom_factor:', zoom_factor)\n            //if (current_step == step_highs[snapped_index] && current_step != Number.MAX_SAFE_INTEGER) {\n            //    if (zoom_factor > 1) { //zooming in \n            //        snapped_index -= 1\n            //    }\n            //    else if (zoom_factor < 1) { //zooming out\n            //        snapped_index += 1\n            //    }\n            //}\n\n            snapped_step = step_highs[snapped_index]\n            if (current_step != Number.MAX_SAFE_INTEGER) {\n                if (//current_step < step //zoom out\n                    zoom_factor < 1\n                    && snapped_step <= current_step) { //wrong direction or no zooming because of snapping\n                    snapped_index += 1\n                }\n                else if (//current_step > step //zoom in\n                    zoom_factor > 1\n                    && snapped_step >= current_step) { //wrong direction because of snapping\n                    snapped_index -= 1\n                }\n            }\n            snapped_step = step_highs[snapped_index]\n            //console.log('ssctree.js snapped_step:', snapped_step)\n\n            let adjusted_step_diff = Math.abs(snapped_step - current_step)\n\n            if (current_step != Number.MAX_SAFE_INTEGER) {\n                time_factor = adjusted_step_diff / normal_step_diff\n            }\n\n            //console.log('ssctree.js adjusted_step_diff:', adjusted_step_diff)\n            //console.log('ssctree.js normal_step_diff:', normal_step_diff)\n            //console.log('ssctree.js time_factor:', time_factor)\n\n            //console.log('ssctree.js snapped_step:', step)\n        }\n\n        //return Math.max(0, step)\n        return time_factor\n    }\n\n    get_St_from_step(step) {\n        let Nb = this.tree.metadata.no_of_objects_Nb\n        let St = this.tree.metadata.start_scale_Sb * Math.pow(Nb / (Nb - step), 0.5)\n\n        //console.log('transform.js step, Nb, Sb, St:', step, Nb, this.tree.metadata.start_scale_Sb, St)\n        return St\n    }\n\n}\n\n\nfunction snap_to_existing_stephigh(step, step_highs) {\n\n    let start = 0, end = step_highs.length - 1;\n    // Iterate while start not meets end \n    while (start <= end) {\n\n        // Find the mid index \n        let mid = Math.floor((start + end) / 2);\n\n        // If element is present at mid, return True \n        if (step_highs[mid] == step) return mid;\n\n        // Else look in left or right half accordingly \n        else if (step_highs[mid] < step)\n            start = mid + 1;\n        else\n            end = mid - 1;\n    }\n\n    //console.log('ssctree.js start and end:', start, end)\n    //console.log('step_highs[start], step, step_highs[end]:', step_highs[start], step, step_highs[end])\n    //console.log('step_highs[start] - step, step - step_highs[end]:', step_highs[start] - step, step - step_highs[end])\n    if (step_highs[start] - step <= step - step_highs[end]) { //start is already larger than end by 1\n        return Math.min(start, step_highs.length - 1) //start will be larger than the last value of step_highs[0] if step is larger than all the values of step_highs    \n    }\n    else {\n        return Math.max(end, 0) //end will be negtive if step is smaller than step_highs[0]\n    }\n}\n\n\nfunction obtain_overlapped_dataelements(node, box3d) {\n    // console.log(box)\n    let result = []\n    let stack = [node]\n    while (stack.length > 0) {\n        let node = stack.pop()\n\n        if (node.hasOwnProperty('children') === true)\n        {\n            // visit chids, if they overlap\n            node.children.forEach(child => {\n                if (overlaps3d(node.box, box3d)) {\n                    stack.push(child)\n                }\n            });\n        }\n\n        // add data elements to result list, if box overlaps\n        if (node.hasOwnProperty('dataelements') === true)\n        {\n            node.dataelements.forEach(element => {\n                if (overlaps3d(element.box, box3d)) {\n                    result.push(element)\n                }\n            });\n        }\n    }\n    return result\n}\n\n\nfunction obtain_overlapped_subtrees(node, box3d) {\n    let result = []\n    let stack = [node]\n    while (stack.length > 0) {\n        let node = stack.pop()\n        if (node.hasOwnProperty('children') === true)\n        {\n            // visit chids, if they overlap\n            node.children.forEach(child => {\n                if (child.hasOwnProperty('children'))\n                {\n                    stack.push(child)\n                }\n                else if (child.hasOwnProperty('uri') && !child.hasOwnProperty('loaded')\n                    && overlaps3d(child.box, box3d)) {\n                    result.push(child)\n                    child.loaded = true;\n                }\n            });\n        }\n\n    }\n    return result\n}\n\n\nfunction obtain_dataelements(root) {\n    // FIXME: make iterator/generator function* \n    // to avoid making the whole result list in memory\n    let result = []\n    let stack = [root]\n    while (stack.length > 0) {\n        const node = stack.pop()\n\n        if (node.hasOwnProperty('children') === true)\n        {\n            // visit chids, if they overlap\n            node.children.forEach(child => {\n                stack.push(child)\n            });\n        }\n        if (node.hasOwnProperty('dataelements') === true)\n        {\n            // add data elements to result list\n            node.dataelements.forEach(element => {\n                result.push(element)\n            });\n        }\n    }\n    return result\n}\n\n/*\nfunction overlaps2d(one, other) {\n    // Separating axes theorem\n    // xmin=[0][0]\n    // xmax=[1][0]\n    // ymin=[0][1]\n    // ymax=[1][1]\n    // If one of the following is true then there can be no overlap\n    return !(one[1][0] < other[0][0] ||\n        one[0][0] > other[1][0] ||\n        one[1][1] < other[0][1] ||\n        one[0][1] > other[1][1])\n}\n*/\n\nexport function overlaps3d(one, other) {\n    // Separating axes theorem, nD -> 3D\n    // e.g., one: [182000, 308000, 0, 191000, 317000, 7]\n    // e.g., other: [185210.15625, 311220.96875, 0, 187789.84375, 313678.9375, 0]\n\n    const dims = 3\n    let are_overlapping = true;\n    for (let min = 0; min < dims; min++) {\n        let max = min + dims\n        if ((one[max] < other[min]) || (one[min] > other[max])) {\n            are_overlapping = false\n            break\n        }\n    }\n    //console.log('ssctree.js are_overlapping:', are_overlapping)\n    return are_overlapping\n}\n\nfunction center2d(box3d) {\n    // 2D center of bottom of box\n    let xmin = box3d[0]\n    let ymin = box3d[1]\n    let xmax = box3d[3]\n    let ymax = box3d[4]\n    return [xmin + 0.5 * (xmax - xmin),\n    ymin + 0.5 * (ymax - ymin)]\n}\n\nfunction distance2d(target, against) {\n    // find projected distance between 2 box3d objects\n    let ctr_t = center2d(target)\n    let ctr_a = center2d(against)\n    let dx2 = Math.pow(ctr_a[0] - ctr_t[0], 2)\n    let dy2 = Math.pow(ctr_a[1] - ctr_t[1], 2)\n    return Math.sqrt(dx2 + dy2)\n}\n\n\n\n\nclass WorkerHelper {\n    constructor() {\n        this.tasks = {}\n        this.worker = new Worker('worker.js')\n        this.worker.onmessage = (evt) => { this.receive(evt) } //evt: {id: id, msg: arrays}, arrays; see worker.js\n    }\n\n    send(url, callback) //e.g., callback: the function of makeBuffers\n    {\n        // use a random id\n        const id = Math.round((Math.random() * 1e18)).toString(36).substring(0, 10)\n        this.tasks[id] = callback\n        this.worker.postMessage({ id: id, msg: url }) //parse the data of the obj file specified by the url\n    }\n\n    receive(evt) {\n        const id = evt.data.id;\n        const msg = evt.data.msg // e.g., arrays = parse_obj(data_text)\n        this.tasks[id](msg) // execute the callback that was registered while sending\n        delete this.tasks[id]\n    }\n}\n\n\n\nexport class Evictor {\n    constructor(ssctree, gl)\n    {\n        this.ssctree = ssctree\n        this.gl = gl\n    }\n\n    /*\n    // Releasing resources by means of an evictor... \n    // the evict method implements a strategy to decide which resources to evict\n    //\n    // Aspects to consider:\n    // - tile size\n    // - when was it last used\n    // - how far is it away from the center of the map\n    // - is it currently displayed\n    // - ... ?\n    */\n    evict(box3d)\n    {\n        let gl = this.gl\n        let to_evict = []\n        if (this.ssctree.tree === null) { return; }\n        let dataelements = obtain_dataelements(this.ssctree.tree).filter(elem => { return elem.loaded })\n        console.log('number of loaded tiles: ' + dataelements.length)\n        dataelements.forEach(\n            tile =>\n            {\n                // remove tiles that were rendered more than 3 seconds ago\n                // and that are currently not on the screen\n                if (tile.last_touched !== null && (tile.last_touched + 3000) < now() \n                    && !overlaps3d(box3d, tile.box))\n                {\n                    to_evict.push(tile)\n                }\n            }\n        )\n        console.log('number of tiles for which memory will be released: ' + to_evict.length)\n        to_evict.forEach(tile => {\n            tile.content.destroy(gl)\n            tile.content = null\n            tile.last_touched = null\n            tile.loaded = false\n        })\n        // when we have removed tiles, let's clear the screen (both color and depth buffer)\n        if (to_evict.length > 0 )\n        {\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)\n        }\n    }\n}\n\nexport default SSCTree\n\n","// from https://github.com/kelektiv/node-uuid\n// mit license\n\n// Lookup Table\n//let byteToHex = [];\n\n//for (let i = 0; i < 256; ++i) {\n//    byteToHex[i] = (i + 0x100).toString(16).substr(1);\n//}\n\n//function bytesToUuid(buf, offset) {\n//    let i = offset || 0;\n//    let bth = byteToHex;\n//    // join used to fix memory issue caused by concatenation: \n//    // https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n//    return ([bth[buf[i++]], bth[buf[i++]],\n//    bth[buf[i++]], bth[buf[i++]], '-',\n//    bth[buf[i++]], bth[buf[i++]], '-',\n//    bth[buf[i++]], bth[buf[i++]], '-',\n//    bth[buf[i++]], bth[buf[i++]], '-',\n//    bth[buf[i++]], bth[buf[i++]],\n//    bth[buf[i++]], bth[buf[i++]],\n//    bth[buf[i++]], bth[buf[i++]]]).join('');\n//}\n\n//function mathRNG() {\n//    let rnds = new Array(16);\n//    for (let i = 0, r; i < 16; i++) {\n//        if ((i & 0x03) === 0) {\n//            r = Math.random() * 0x100000000;\n//        }\n//        rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n//    }\n//    return rnds;\n//}\n\nfunction getUuid() {\n//    let x = mathRNG();\n//    return bytesToUuid(x);\n    return Math.round((Math.random() * 1e18)).toString(36).substring(0, 10)\n}\n// end: from https://github.com/kelektiv/node-uuid\n\n\nclass MessageBus {\n    constructor() {\n        this._topics = {}; // {topic: [subscriberFn, ...], ...}\n    }\n\n    publish(topic, message, sender) {\n        // console.log('publish invoked ' + topic + ' ' + sender + ' ' + message);\n        if (sender === null) {\n            sender = 0\n        }\n        let subscribers = this._topics[topic];\n        if (!subscribers) {\n            return false;\n        }\n        subscribers.forEach(subscriberFn => {\n            setTimeout(subscriberFn(topic, message, sender), 0)\n        });\n\n        return true;\n    }\n\n    subscribe(topic, func) {\n        // if the topic list does not exist yet, make one\n        if (!this._topics[topic]) {\n            this._topics[topic] = [];\n        }\n        // add the topic to the list\n        this._topics[topic].push(func)\n        // return reference to arrow function that removes subscription, once invoked\n        return {\n            remove: (() => {\n                // console.log('Invoking remove')\n                // console.log(this._topics[topic])\n                // console.log('old length ' + this._topics[topic].length)\n                let index = this._topics[topic].indexOf(func)\n                // console.log(index)\n                this._topics[topic].splice(index, 1)\n                // console.log('new length ' + this._topics[topic].length)\n                if (this._topics[topic].length === 0) {\n                    delete this._topics[topic]\n                }\n            })\n        }\n    }\n\n}\n\nconst instance = new MessageBus();\nObject.freeze(instance);\n\n\nexport class MessageBusConnector {\n\n    constructor() {\n        this.id = getUuid()\n    }\n\n    publish(topic, message) {\n        return instance.publish(topic, message, this.id)\n    }\n\n    subscribe(topic, func) {\n        return instance.subscribe(topic, func)\n    }\n}\n\nexport default MessageBusConnector;\n","\"use strict\";\n\n// const bindHandler = require('./handler');\nimport { dragHandler } from './handlers/mouse.drag';\nimport { moveHandler } from './handlers/mouse.move';\nimport { scrollHandler } from './handlers/mouse.scroll';\nimport { zoomButtonHandler } from './handlers/mouse.scroll';\nimport { touchPinchHandler } from './handlers/touch.pinch';\nimport { touchDragHandler } from \"./handlers/touch.drag\";\n\nimport Transform from './transform';\nimport { timed } from './animate';\nimport { Renderer } from \"./render\";\n\n// import MyLoader from './loader';\n// import { TileSet , Evictor } from './tiles';\nimport { SSCTree, Evictor } from './ssctree';\n\nimport { MessageBusConnector } from './pubsub'\n\nclass Map {\n    constructor(map_settings) {\n        //console.log('map.js test:')\n        //console.log('map.js map_settings:', map_settings)\n        this.ssctree_lt = []\n        let container = map_settings['canvas_nm']\n        if (typeof container === 'string') {\n            this._container = window.document.getElementById(container)\n        }\n        else {\n            this._container = container\n        }\n        if (!this._container) {\n            throw new Error(`Container '${container}' not found.`)\n        }\n\n        // FIXME: to not circle map updates (can this be done more elegantly?)\n//        this._should_broadcast_move = true;\n\n        this._abort = null\n        this._transform = new Transform(map_settings.initialization.center2d,\n                                        [this.getCanvasContainer().width, this.getCanvasContainer().height],\n                                        map_settings.initialization.scale_den)\n\n        /* settings for zooming and panning */\n        this._interaction_settings = {\n            zoom_factor: 1,\n            zoom_duration: 1000,\n            time_factor: 1, //we prolong the time because we merge parallelly\n            pan_duration: 1000\n        };\n        this.if_snap = false\n\n        this.msgbus = new MessageBusConnector()\n\n        this.msgbus.subscribe('data.tile.loaded', (topic, message, sender) => {\n            //console.log('1 subscribe data.tile.loaded')\n            if (this._abort === null) {\n                //console.log('Rendering because received:', topic, \", \", message, \", \", sender)\n                this.panAnimated(0, 0) // animate for a small time, so that when new tiles are loaded, we are already rendering\n            }\n        })\n\n        this.msgbus.subscribe('data.tree.loaded', (topic, message, sender) => {\n            let St = this._transform.getScaleDenominator()\n            var step = this.ssctree.get_step_from_St(St, true)\n            this._prepare_active_tiles(step)\n            this.panAnimated(0, 0) // animate for a small time, so that when new tiles are loaded, we are already rendering\n        })\n\n        this.msgbus.subscribe(\"settings.render.boundary-width\", (topic, message, sender) => { \n            this.renderer.settings.boundary_width = parseFloat(message);\n            this.abortAndRender();\n        } );\n\n        this.msgbus.subscribe(\"settings.interaction.zoom-factor\", (topic, message, sender) => {\n//            console.log(message);\n            this._interaction_settings.zoom_factor = parseFloat(message);\n            this.abortAndRender();\n        });\n\n        this.msgbus.subscribe(\"settings.interaction.zoom-animation\", (topic, message, sender) => {\n//            console.log(message);\n            this._interaction_settings.zoom_duration = parseFloat(message);\n            this.abortAndRender();\n        });\n        this.msgbus.subscribe(\"settings.interaction.pan-animation\", (topic, message, sender) => {\n//            console.log('setting pan_duration: ' + message);\n            this._interaction_settings.pan_duration = parseFloat(message);\n            this.abortAndRender();\n        });\n\n\n        map_settings.datasets.forEach((dataset) => {\n            //console.log('map.js dataset:', dataset)\n            this.ssctree_lt.push(new SSCTree(this.msgbus, dataset))\n        })\n\n        if (this.ssctree_lt.length > 1) {\n            //for the data from FEM, we draw the back faces because the triangles are clockwise\n            //PLEASE check the directions of your triangles.\n\n            // FIXME: these settings should be specified per dataset in the *settings* property of the SSCtree\n            for (var i = 1; i < this.ssctree_lt.length; i++) {\n                this.ssctree_lt[i].bln_glfront = false\n                this.ssctree_lt[i].bln_depth_test = false\n                this.ssctree_lt[i].bln_blend = true\n                this.ssctree_lt[i].opacity = 0.5\n            }\n            //this.ssctree_lt[0].bln_glfront = true\n            //this.ssctree_lt[0].bln_depth_test = true\n            //this.ssctree_lt[0].bln_blend = false\n            //this.ssctree_lt[0].opacity = 0.5\n            //this.ssctree_lt[2].bln_glfront = true\n        }\n\n\n        // data load\n        //this.ssctree = new SSCTree(this.msgbus, map_settings.datasets[0])\n\n        this.ssctree = this.ssctree_lt[0]\n        this.renderer = new Renderer(this.getWebGLContext(), this.ssctree_lt);\n        this.renderer.setViewport(this.getCanvasContainer().width,\n                                  this.getCanvasContainer().height)\n\n        dragHandler(this)  // attach mouse handlers\n        scrollHandler(this)\n        zoomButtonHandler(this)\n//        moveHandler(this)\n        touchPinchHandler(this) // attach touch handlers\n        touchDragHandler(this)\n\n\n        { \n            let St = this.getTransform().getScaleDenominator()\n            this.ssctree.get_step_from_St(St, true)\n            this.msgbus.publish('map.scale', [this.getTransform().getCenter(), St]) \n        }\n\n        this.evictor = new Evictor(this.ssctree,\n                                   this.getWebGLContext())\n        // every 30 seconds release resources\n        window.setInterval(\n            () => {\n\n                let St = this.getTransform().getScaleDenominator()\n                var step = this.ssctree.get_step_from_St(St, true)\n\n                //const near_St = this.ssctree.stepMap(this.getTransform().getScaleDenominator())\n                //const near = near_St[0]\n                const box2d = this.getTransform().getVisibleWorld()\n                const box3d = [box2d.xmin, box2d.ymin, step, box2d.xmax, box2d.ymax, step]\n                this.evictor.evict(box3d)\n                this.render()\n            },\n            60 * 1000 * 2.5 // every X mins (expressed in millisec)\n        )\n\n    }\n\n    loadTree() {\n        //this.ssctree.load()\n\n        this.ssctree_lt.forEach((ssctree) => {\n            //console.log('map.js ssctree.dataset:', ssctree.dataset)\n            var if_snap = ssctree.load()\n            if (if_snap == true) {\n                this.if_snap = true\n            }\n        })\n    }\n\n    getCanvasContainer() {\n        return this._container;\n    }\n\n    getWebGLContext() {\n        return this.getCanvasContainer().getContext('webgl', \n            { antialias: true, alpha: false, premultipliedAlpha: false})\n    }\n\n    getTransform() {\n        return this._transform;\n    }\n\n    render(k = 0) {\n\n        //if k==1, we are at the end of a zooming operation, \n        //we directly use the snapped_step and snapped_St to avoid rounding problems\n        let St = 0\n        let step = 0\n        let snapped_step = this.getTransform().snapped_step\n        if (k == 1 && this.if_snap == true &&\n            snapped_step != Number.MAX_SAFE_INTEGER) { //we are not at the state of just having loaded data\n            St = this.getTransform().snapped_St\n            step = snapped_step\n        }\n        else {\n            St = this.getTransform().getScaleDenominator()\n            //console.log('map.js render, test')\n            step = this.ssctree.get_step_from_St(St)\n        }\n\n        step -= 0.001 //to compensate with the rounding problems\n        \n        this.msgbus.publish('map.scale', [this.getTransform().getCenter(), St])\n\n        let last_step = Number.MAX_SAFE_INTEGER\n        if (this.ssctree.tree != null) { //the tree is null when the tree hasn't been loaded yet. \n            last_step = this.ssctree.tree.metadata.no_of_steps_Ns\n        }\n        //console.log('map.js render, last_step:', last_step)\n\n        //var step = this.ssctree.get_step_from_St(St) //+ 0.001\n        //console.log('map.js, step before snapping:', step)\n        //if (k ==1) { //in this case, we are at the end of a zooming operation, we test if we want to snap\n        //    var snapped_step = this.ssctree.get_step_from_St(St, true, this._interaction_settings.zoom_factor)\n        //    if (Math.abs(step - snapped_step) < 0.001) { //snap to an existing step\n        //        step = snapped_step\n        //    }\n        //}\n        \n        \n\n        if (step < 0) {\n            step = 0\n        }\n        else if (step >= last_step) {\n            step = last_step\n        }\n\n        //console.log('map.js, step after snapping:', step)\n\n\n        var matrix_box3d = this._prepare_active_tiles(step)\n        this.renderer.render_relevant_tiles(matrix_box3d[0], matrix_box3d[1], [step, St]);\n    }\n\n    _prepare_active_tiles(near) {\n        let matrix = this.getTransform().world_square\n        const far = -0.5\n        matrix[10] = -2.0 / (near - far)\n        matrix[14] = (near + far) / (near - far)\n        const box2d = this.getTransform().getVisibleWorld()\n        const box3d = [box2d.xmin, box2d.ymin, near, box2d.xmax, box2d.ymax, near]\n        let gl = this.getWebGLContext();\n        this.ssctree_lt.forEach(ssctree => { ssctree.fetch_tiles(box3d, gl)})\n        //this.ssctree.fetch_tiles(box3d, gl)\n        return [matrix, box3d]\n    }\n\n    doEaseNone(start, end) {\n        let interpolate = ((k) => {\n            var m = new Float32Array(16);\n            for (let i = 0; i < 16; i++) {\n                let delta = start[i] + k * (end[i] - start[i]);\n                m[i] = delta;\n            }\n            // update the world_square matrix\n            this.getTransform().world_square = m;\n            this.getTransform().updateViewportTransform()\n            this.render(k);\n            if (k == 1) {\n                this._abort = null\n            }\n        })\n        return interpolate;\n    }\n\n    doEaseInOutSine(start, end) {\n        function interpolate(k) {\n            var m = new Float32Array(16);\n            let D = Math.cos(Math.PI * k) - 1\n            for (let i = 0; i < 16; i++) {\n                let c = end[i] - start[i];\n                let delta = -c * 0.5 * D + start[i];\n                m[i] = delta;\n            }\n            // update the world_square matrix\n            this.getTransform().world_square = m;\n            this.getTransform().updateViewportTransform()\n            this.render(k);\n            if (k == 1) {\n                this._abort = null\n            }\n        }\n        return interpolate;\n    }\n\n    doEaseOutSine(start, end) { //start: the start world square; end: the end world square\n        let interpolate = (k) => {\n            var m = new Float32Array(16);\n            let D = (Math.sin(k * (Math.PI * 0.5)));\n            for (let i = 0; i < 16; i++) {\n                let c = end[i] - start[i];\n                let delta = c * D + start[i];\n                m[i] = delta;\n            }\n            // update the world_square matrix\n            this.getTransform().world_square = m;\n            this.getTransform().updateViewportTransform()\n            this.render(k);\n            if (k === 1) {\n                this._abort = null\n            }\n        }\n        return interpolate;\n    }\n\n    doEaseOutQuint(start, end) {\n        function interpolate(k) {\n            let t = k - 1\n            let t5p1 = Math.pow(t, 5) + 1\n            var m = new Float32Array(16);\n            for (let i = 0; i < 16; i++) {\n                let c = end[i] - start[i];\n                let delta = c * t5p1 + start[i];\n                m[i] = delta;\n            }\n            // update the world_square matrix\n            this.getTransform().world_square = m;\n            this.getTransform().updateViewportTransform()\n            this.render(k);\n            if (k == 1) {\n                this._abort = null\n            }\n        }\n        return interpolate;\n    }\n\n    animateZoom(x, y, zoom_factor) {\n        const start = this.getTransform().world_square;\n        this._interaction_settings.time_factor = this.getTransform().zoom(\n            this.ssctree, zoom_factor, x, this.getCanvasContainer().getBoundingClientRect().height - y, this.if_snap);\n        const end = this.getTransform().world_square;\n        var interpolate = this.doEaseOutSine(start, end);\n        return interpolate;\n    }\n\n    animatePan(dx, dy) {\n        const start = this.getTransform().world_square;\n        this.getTransform().pan(dx, -dy);\n        const end = this.getTransform().world_square;\n        var interpolate = this.doEaseOutSine(start, end);\n        return interpolate;\n    }\n\n    jumpTo(x, y, scale) {\n        let center_world = [x, y];\n        let r = this.getCanvasContainer();\n        let viewport_size = [r.width, r.height];\n        let denominator = scale;\n        this._transform.initTransform(center_world, viewport_size, denominator);\n        this.abortAndRender();\n    }\n\n    panBy(dx, dy) {\n        //console.log(\"_abort in map.js:\", this._abort)\n        if (this._abort !== null) {\n            this._abort();\n        }\n        this.getTransform().pan(dx, -dy);\n        this.render();\n    }\n\n    zoom(x, y, factor) {\n        this._interaction_settings.time_factor = this.getTransform().zoom(\n            this.ssctree, factor, x, this.getCanvasContainer().getBoundingClientRect().height - y, this.if_snap);\n        this.render();\n    }\n\n    abortAndRender() {\n        // aborts running animation\n        // and renders the map based on the current transform\n        if (this._abort !== null) {\n            this._abort();\n            this._abort = null;\n        }\n        this.getTransform().pan(0, 0);\n        this.render();\n    }\n\n    zoomInAnimated(x, y, op_factor) {\n        this.zoomAnimated(x, y, 1.0 + op_factor) //e.g., op_factor: 0.0625; 1.0 + op_factor: 1.0625\n    }\n\n    zoomOutAnimated(x, y, op_factor) {\n        this.zoomAnimated(x, y, 1.0 / (1.0 + op_factor)) //e.g., op_factor: 0.0625; 1.0 / (1.0 + op_factor): 0.9411764705882353\n    }\n\n    zoomAnimated(x, y, zoom_factor) {\n        if (this._abort !== null) {\n            //console.log('map.js test1')\n            this._abort();\n        }\n        //console.log('map.js test2')\n        //console.log('map.js this._interaction_settings.time_factor0:', this._interaction_settings.time_factor)\n        //console.log('map.js zoom_factor:', zoom_factor)\n        var interpolator = this.animateZoom(x, y, zoom_factor);\n        this._interaction_settings.zoom_factor = zoom_factor\n        //this.zoom_factor = zoom_factor\n        // FIXME: settings\n\n        let zoom_duration = this._interaction_settings.zoom_duration * this._interaction_settings.time_factor\n        //console.log('map.js this._interaction_settings.zoom_duration:', this._interaction_settings.zoom_duration)\n        //console.log('map.js this._interaction_settings.time_factor:', this._interaction_settings.time_factor)\n        //console.log('map.js zoom_duration:', zoom_duration)\n        this._abort = timed(interpolator, zoom_duration, this);\n    }\n\n    panAnimated(dx, dy) {\n        if (this._abort !== null) {\n            this._abort();\n        }\n        // FIXME: settings\n        var interpolator = this.animatePan(dx, dy);\n        this._abort = timed(interpolator, this._interaction_settings.pan_duration, this);\n    }\n\n    resize(newWidth, newHeight) {\n        //console.log(\"resize\");\n        let tr = this.getTransform();\n        let center = tr.getCenter();\n        let denominator = tr.getScaleDenominator();\n        // re-initialize the transform\n        tr.initTransform(center, [newWidth, newHeight], denominator);\n        // update the viewport size of the renderer\n        this.renderer.setViewport(newWidth, newHeight)\n    }\n\n}\n\nexport default Map\n","// import  Rectangle from \"./rect\"\nimport Map from \"./map\"\nimport MessageBusConnector from \"./pubsub\"\n//let r = new Rectangle(1, 2, 3, 4);\n//console.log(r);\n\nconst exported = {\n    Map,\n    MessageBusConnector\n}\n\nexport default exported;"],"names":["const","let","now","multiply","eye","scale","translate","super","this","node"],"mappings":"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C,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACnD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACpD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACpD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACpD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACpD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;IACpD,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,GAAG,CAAC;;IAEpD,OAAO,GAAG,CAAC;CACd;;;;;;;;;AASD,AAuBC;;;;;;;;AAQD,AAqBC;;;;;;;;;;AAUD,SAAS,QAAQ,CAAC,GAAG,EAAE,CAAC,EAAE,CAAC,EAAE;IACzB,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;QAC9C,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;QAC9C,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC;QAChD,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;;;IAGvD,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IAChD,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;;IAEnD,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;IAC3C,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;IACnD,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,GAAG,EAAE,GAAG,GAAG,CAAC;;IAEnD,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,C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"}
